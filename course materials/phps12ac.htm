<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
</head><body><mledit by="insert_name" date="insert_date" note="insert_note"></mledit>

<script language="JavaScript" src="phps12ac_files/mlclientpage.js"></script>
<noscript><P>Your browser does not support script tags. Please update your system with a browser that supports them.</P></noscript>

<script language="JavaScript" src="phps12ac_files/site.js"></script><script language="Javascript" src="phps12ac_files/resource_strings.js"></script><script language="Javascript" src="phps12ac_files/special_cases.js"></script>
<noscript><P>Your browser does not support script tags. Please update your system with a browser that supports them.</P></noscript>

<script language="JavaScript">var ThisPage=new MlPage();</script>
<noscript><P>Your browser does not support script tags. Please update your system with a browser that supports them.</P></noscript>

<title>PHP and MySQL: Extended Topics</title>

<script language="JavaScript">var crsAcronym="phps12";</script>
<noscript><P>Your browser does not support script tags. Please update your system with a browser that supports them.</P></noscript>

<script language="JavaScript" src="phps12ac_files/access.js"></script><script language="Javascript" src="phps12ac_files/params.js"></script><script language="Javascript" src="phps12ac_files/courseware.js"></script><script language="Javascript" src="phps12ac_files/phps12.js"></script><script language="Javascript" src="phps12ac_files/printbut.js"></script><table width="97%"><tbody><tr><td align="right"><div id="printButton" class="printbut" onclick="javascript:printPage();" onmouseover="this.style.backgroundPosition='-48px -24px';" onmouseout="this.style.backgroundPosition='-48px 0px';" title="Print"></div></td></tr></tbody></table>
<noscript><P>Your browser does not support script tags. Please update your system with a browser that supports them.</P></noscript>


<!--<DPECTPL>access</DPECTPL>-->

<h1>PHP and MySQL: Extended Topics</h1>
<script language="JavaScript">
var numAccQuestions =30;
writeAccIntro();
</script>You can print this text-only version of this course for future reference.<br>&nbsp;<br> If you wish to use the accessible version of our courses, which includes questions in text-only format, click <b>Text Only</b> on the log on page, and then enter your user ID and password from the Accessibility Log On page.
<noscript><P>Your browser does not support script tags. Please update your system with a browser that supports them.</P></noscript>

<hr>
<a name="skipped">
</a><a name="pha001"></a>
<br><a name="topic1"></a><h2>Lesson 1. Course Introduction</h2><dpecw1>

This course covers extended topics that are not applicable to every Web application but are certainly worth your consideration. <br>
First, the task of handling file uploads with PHP will be covered. After
 that, you will see how you can use PHP and JavaScript together. Next, 
you will see output buffering, which controls when data is sent to the 
Web browser. <br>
From there you will head back into the world of MySQL, starting with the
 set of new, improved MySQL Extension functions. These have been added 
to PHP in version 5 and were specifically made for working with MySQL 
version 4.1 and above. Then, a couple of recent additions to the MySQL 
software are covered, specifically transactions and prepared statements.
 <br>
Finally, this course concludes with an introduction and demonstration of
 PEAR. PEAR is a special framework of PHP code that can save you lots of
 development and debugging time.<br>
Not every application you write will require all of these features. In 
fact, the special server requirements of some of them constitute a 
limitation. But being aware of their existence and having an 
understanding of the syntax will be a great asset when the time does 
come to incorporate any of these concepts.

</dpecw1><br>
<a name="phb001"></a><br><a name="topic2"></a><h2>Lesson 2. Handling File Uploads</h2><dpecw1>

To accept file uploads in your HTML forms, certain settings must be 
established in order for PHP to be able to handle the file uploads. In 
addition to establishing PHP settings for optimum upload time, you will 
need to regulate storage folder permissions so the uploaded files are 
protected.<br>
After completing this lesson, you should be able to:<br>
<ul>
	<li>
Adjust PHP script settings to accept file uploads in your forms
	</li>
	<li>
Create folders for storing the file uploads
	</li>
	<li>
Set storage folder permissions for maximum security
	</li>
</ul>

</dpecw1><br>
<a name="phb002"></a>
<br><dpecw1>

<b>* Accepting File Uploads</b><br>
Like handling any HTML form using PHP, the process of uploading a file has two dimensions. <br>
First the HTML form must be displayed, with the proper code to allow for
 file uploads. Then, upon submission of the form, the PHP script must 
copy the uploaded file to the proper location.

</dpecw1><br>
<a name="phb003"></a>
<br><dpecw1>

However, for this process to work, several things must be in place:<br>
<ul>
	<li>
PHP must run with the proper settings.
	</li>
	<li>
A temporary storage directory must exist with the proper permissions.
	</li>
	<li>
The final storage directory must exist with the proper permissions.
	</li>
</ul>
With this in mind, we will first adjust the server to ensure that file 
uploads are allowed. Then we'll create the upload script itself. 

</dpecw1><br>
<a name="phb004"></a>
<br><dpecjs><b>* Allowing for File Uploads</b>
<br>
Certain settings must be established in order for PHP to be able to 
handle file uploads. Before walking through the steps, we'll first 
discuss why or when you'd need to make these adjustments. 
The first issue is PHP itself. There are several settings in the <tt>php.ini</tt>
 file that dictate how PHP handles uploads, specifically dictating how 
large of a file can be uploaded and where the upload should temporarily 
be stored.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>;;;;;;;;;;;;;;;;</tt><br>
<tt>; File Uploads ;</tt><br>
<tt>;;;;;;;;;;;;;;;;</tt><br>
<tt>; Whether to allow HTTP file uploads.</tt><br>
<tt>file_uploads = On</tt><br>
<br>
<tt>; Temporary directory for HTTP uploaded files (will use system default</tt><br>
<tt>; if not specified).</tt><br>
<tt>;upload_tmp_dir =</tt><br>
<br>
<tt>; Maximum allowed size for uploaded files.</tt><br>
<tt>upload_max_filesize = 2M</tt></dpeccode><br>
<a name="phb005"></a>
<br><dpecw1>

Generally speaking, you'll need to edit this file if either of these two conditions applies:<br>
<ul>
	<li>
You installed PHP on your own Windows computer.
	</li>
	<li>
You will be uploading very large files (larger than 2 MB).
	</li>
</ul>
If you don't have access to your <tt>php.ini</tt> file, meaning that 
you're using a hosted site, presumably the host has already made the 
necessary alterations. If you installed PHP on Mac OS X or Unix, you 
should also be good to go (assuming reasonable-sized files). 

</dpecw1><br>
<a name="phb006"></a>
<br><dpecjs>The second issue is the location of, and permissions on, the
 temporary directory. This is where PHP will store the uploaded file 
until your PHP script moves it to its final destination. If you 
installed PHP on your own Windows computer, you'll need to take steps 
here. 
Mac OS X and Unix users need not worry about this.
<br>

<a name="phb007"></a>
<br><dpecjs>Finally, the final destination folder must be created and 
have the proper permissions established on it. This is a step that 
everyone<i> </i>must take for every<i> </i>application that handles file uploads.
With all of that in mind, let's walk through the steps.
<br>

<a name="phb008"></a>
<br><dpecjs><b>* Step 1</b>
<br>
Open <tt>php.ini</tt> in your text editor. 
<br>
</dpecjs><br><dpeccode>
<br>
<tt>[PHP]</tt><br>
<tt>;;;;;;;;;;;</tt><br>
<tt>; WARNING ;</tt><br>
<tt>;;;;;;;;;;;</tt><br>
<tt>; This is the default settings file for new PHP installations.</tt><br>
<tt>; By default, PHP installs itself with a configuration suitable for</tt><br>
<tt>; development purposes, and *NOT* for production purposes.</tt><br>
<tt>; For several security-oriented considerations that should be taken</tt><br>
<tt>; before going online with your site, please consult php.ini-recommended</tt><br>
<tt>; and http://php.net/manual/en/security.php.</tt><br>
<tt>;;;;;;;;;;;;;;;;;;;</tt><br>
<tt>; About php.ini;</tt><br>
<tt>;;;;;;;;;;;;;;;;;;;</tt><br>
<tt>; This file controls many aspects of PHP's behavior.&nbsp;&nbsp;In order for PHP to</tt><br>
<tt>; read it, it must be named 'php.ini'.&nbsp;&nbsp;PHP looks for it in the current</tt><br>
<tt>; working directory, in the path designated by the environment variable</tt><br>
<tt>; PHPRC, and in the path that was defined in compile time (in that order).</tt><br>
<tt>; Under Windows, the compile-time path is the Windows directory.&nbsp;&nbsp;The</tt><br>
<tt>; path in which the php.ini file is looked for can be overridden using</tt><br>
<tt>; the -c argument in command line mode.</tt><br>
<tt>;</tt>
</dpeccode><br>
<a name="phb009"></a>
<br><dpecjs><b>* Step 2</b>
<br>
Under the File Uploads section, adjust the following lines as needed: 
<tt>file_uploads</tt>
<tt>upload_tmp_dir</tt>
<tt>upload_max_filesize</tt>
<br>
</dpecjs><br><dpeccode>
<br>
<tt>;;;;;;;;;;;;;;;;</tt><br>
<tt>; File Uploads ;</tt><br>
<tt>;;;;;;;;;;;;;;;;</tt><br>
<tt>; Whether to allow HTTP file uploads.</tt><br>
<tt>file_uploads = On</tt><br>
<br>
<tt>; Temporary directory for HTTP uploaded files (will use system default</tt><br>
<tt>; if not specified).</tt><br>
<tt>;upload_tmp_dir =</tt><br>
<br>
<tt>; Maximum allowed size for uploaded files.</tt><br>
<tt>upload_max_filesize = 2M</tt><br>
</dpeccode><br>
<a name="phb010"></a>
<br><dpecjs><b>* Can't Edit?</b>
<br>
If you are not allowed to edit your <tt>php.ini</tt> file (if, for 
instance, you're using a hosted server), then presumably any necessary 
edits would have already been made to allow for file uploads. You can 
confirm this by checking the settings listed in Step 2 in a <tt>phpinfo()</tt> script.
<br>

<a name="phb011"></a>
<br><dpecjs>The first line dictates whether or not uploads are allowed.
<br>

<a name="phb012"></a>
<br><dpecjs>The second line states where the uploaded files should be 
temporarily stored. On most operating systems, including Mac OS X and 
Unix, this setting can be left commented out (preceded by a semicolon) 
without any problem. 
<br>

<a name="phb013"></a>
<br><dpecjs><b>* Setting the</b>
<br> <tt>upload_tmp_dir</tt>
If you are running Windows, set this value to <tt>C:\\tmp</tt>, making sure that the line is not<i> </i>preceded by a semicolon.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>;;;;;;;;;;;;;;;;</tt><br>
<tt>; File Uploads ;</tt><br>
<tt>;;;;;;;;;;;;;;;;</tt><br>
<tt>; Whether to allow HTTP file uploads.</tt><br>
<tt>file_uploads = On</tt><br>
<tt>; Temporary directory for HTTP uploaded files (will use system default</tt><br>
<tt>; if not specified).</tt><br>
<tt>upload_tmp_dir = C:\tmp</tt><br>
<br>
<tt>; Maximum allowed size for uploaded files.</tt><br>
<tt>upload_max_filesize = 2M</tt>
</dpeccode><br>
<a name="phb014"></a>
<br><dpecjs>Finally, a maximum upload file size is set, in megabytes.
<br>

<a name="phb015"></a>
<br><dpecjs>The <tt>post_max_size</tt> setting in the <tt>php.ini</tt> 
file dictates the total amount of data (in megabytes) that can be 
uploaded by a single script. It's set at 8 MB by default. If you want to
 accept a large file upload, you must also increase this value 
accordingly.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>; performance gain. The PHP directives register_globals, register_long_arrays,</tt><br>
<tt>; and register_argc_argv must be disabled for this directive to have any affect.</tt><br>
<tt>auto_globals_jit = On</tt><br>
<tt>; Maximum size of POST data that PHP will accept.</tt><br>
<tt>post_max_size = 8M</tt><br>
<br>
<tt>; Magic quotes</tt><br>
<tt>;</tt><br>
</dpeccode><br>
<a name="phb016"></a>
<br><dpecjs>Because of the time it may take to upload a large file, you may also need to change the <tt>max_execution_time</tt> value in the <tt>php.ini</tt> file or temporarily bypass it using the <tt>set_time_limit()</tt> function in your script.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>;;;;;;;;;;;;;;;;;;;</tt><br>
<tt>; Resource Limits ;</tt><br>
<tt>;;;;;;;;;;;;;;;;;;;</tt><br>
<tt>max_execution_time = 30&nbsp;&nbsp;; Maximum execution time of each script, in seconds</tt><br>
<tt>max_input_time = 60</tt>&nbsp;&nbsp;&nbsp;&nbsp;<tt>; Maximum amount of time each script may spend parsing request data</tt><br>
<tt>memory_limit = 8M&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;; Maximum amount of memory a script may consume (8MB)</tt><br>
</dpeccode><br>
<a name="phb017"></a>
<br><dpecjs><b>* Step 3</b>
<br>
Save the <tt>php.ini</tt> file...
<br>

<a name="phb018"></a>
<br><dpecw1>

...and restart your Web server.<br>
How you restart your Web server depends upon the operating system and Web serving application being used. <br>
Using Apache on Mac OS X, it's just a matter of going through the System Preferences"Sharing panel.<br>

</dpecw1><br><dpeccode>
<br>
<tt>U:\&gt;</tt><br>
<br>
</dpeccode><br>
<a name="phb019"></a>
<br><dpecw1>

Windows users running Apache can type the following within a DOS prompt:<br>
<tt>NET STOP APACHE <br>
NET START APACHE </tt><br>
Unix and Linux users will normally use the command:<br>
<tt>apachectl graceful</tt>

</dpecw1><br><dpeccode>
<br>
<tt>U:\&gt;net stop apache</tt><br>
<tt>The Apache service is stopping.</tt><br>
<tt>The Apache service was stopped successfully.</tt><br>
<tt>U:\&gt;net start apache</tt><br>
<tt>The Apache service is starting.</tt><br>
<tt>The Apache service was started successfully.</tt><br>
<tt>U:\&gt;</tt><br>
</dpeccode><br>
<a name="phb020"></a>
<br><dpecjs><b>* Step 4</b>
<br>
If you are running Windows, create a <tt>tmp</tt> folder within <tt>C:\\</tt> and make sure that everyone can write to that directory.
<br>

<a name="phb021"></a>
<br><dpecw1>

PHP, through your Web server, will temporarily store the uploaded file in the <tt>upload_tmp_dir</tt>. For this to work, the Web user (if your Web server runs as a particular user) must have permission to write to the folder. <br>
You may not actually have to change the permissions, but to do so, 
depending upon what version of Windows you are running, you can normally
 adjust the permissions by right-clicking the folder and selecting 
Properties. In the Properties window, there should be a Security tab 
where permissions are set. It may also be under Sharing. 
<br>
<b>Note:</b> Mac OS X and Unix users can skip this step as the temporary directory — <tt>/tmp</tt> — has open permissions already.
<br>

</dpecw1><br>
<a name="phb022"></a>
<br><dpecw1>

<b>* Step 5</b><br>
Create a new directory, called <tt>uploads</tt>, in the same directory where you'll be placing the file upload script. <br>
All of the uploaded files will be permanently stored in the <tt><tt>uploads</tt></tt><i> </i>directory. If you'll be placing your script in the <tt>C:\inetpub\wwwroot\ch11</tt> directory, then create a <tt>C:\inetpub\wwwroot\ ch11\uploads</tt> directory.<br>
Unix people can use the <tt>chmod</tt> command to adjust a folder's permissions.

</dpecw1><br>
<a name="phb023"></a>
<br><dpecjs><b>* Step 6</b>
<br>
Set the permissions on the <tt>uploads</tt><i> </i>directory so that the
 Web server can write to it. Again, Windows users should use the 
Properties window to make these changes. Mac OS X users can<ol type="A"><li>Select the folder in the Finder.</li><li>Press Command+I.</li><li>Allow everyone to Read &amp; Write, under the Ownership &amp; Permissions panel.</li></ol>
<br>

<a name="phb024"></a>
<br><dpecw1>
	
Depending upon your operating system, you may be able to upload files 
without first taking this step. You should try the following script 
before altering the permissions, just to be sure. If you see warning 
messages saying PHP could not move the upload image because of a 
permissions issue, then you will need to make some adjustments.
	
</dpecw1><br>
<a name="phb025"></a>
<br><dpecw1>

Increased security normally comes with a trade-off of decreased 
convenience. The permissions currently set on the uploads folder — 
allowing everyone read and write access — is heavy-handed and quite 
insecure. <br>
Literally anyone can now move, copy, or write files to the uploads 
folder (assuming that they know it exists). A malicious user could write
 a PHP script to your uploads directory and then run that script in the 
Web browser, doing all kinds of damage. There are several possible fixes
 to make this process more secure.

</dpecw1><br>
<a name="phb026"></a>
<br><dpecw1>

Storing uploaded files outside of the Web directory is preferred for 
security reasons. Doing so will deny users access to the files directly 
and avoid placing a folder with loose permissions in a publicly 
accessible place. <br>
For example, if you are running Windows and the root of your Web directory (where <tt>http://<i>localhost</i></tt> points) is <tt>C:\inetpub\wwwroot</tt>, then you would create a <tt>C:\inetpub\uploads</tt> directory. <br>
On Mac OS X, where <tt>/Users/&lt;<i>username</i>&gt;/Sites</tt> is the Web root (<tt>http://<i>localhost</i>/~<i>username</i></tt><i> </i>points there), you would create <tt>/Users/&lt;<i>username</i>&gt;/uploads</tt>. 

</dpecw1><br>
<a name="phb027"></a>
<br><dpecw1>

Unfortunately placing the <tt>uploads</tt><i> </i>folder outside of the 
Web directory would render the set of scripts that display the uploaded 
images completely useless. The uploaded images simply would not be 
viewable.

</dpecw1><br>
<a name="phb028"></a>
<br><dpecw1>

If you must keep the <tt>uploads</tt><i> </i>folder publicly accessible,
 the permissions could be tweaked. For security purposes, you ideally 
want to allow only the Web server user to read, write, and browse this 
directory. This means knowing what user the Web server runs as and 
making that user — and no one else — ruler of the uploads. <br>
This isn't a perfect solution, but it does help a bit. This change also limits your<i> </i>access to that folder, though, as its contents would belong to only the Web server.

</dpecw1><br>
<a name="phb029"></a>
<br><dpecw1>

Finally, if you're using Apache, you could limit access to the <tt>uploads</tt><i> </i>folder using an <tt>.htaccess</tt>
 file. Basically, you would state that only image files in the folder be
 publicly viewable, meaning that even if a PHP script were to be placed 
there, it could not be executed.<br>
Information on how to use <tt>.htaccess</tt> files can be found online (search on "<tt>.htaccess tutorial</tt>").

</dpecw1><br>
<a name="phb030"></a>
<br><dpecw1>

Sometimes even the most conservative programmer will make security 
concessions. The important point is that you're aware of the potential 
concerns and that you do the most you can to minimize the danger.

</dpecw1><br>
<a name="phb032"></a>

<script language="JavaScript">insertAccQuestion('1','phb032.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phb033"></a>

<script language="JavaScript">insertAccQuestion('2','phb033.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phb034"></a>

<script language="JavaScript">insertAccQuestion('3','phb034.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phb035"></a>
<br><a name="topic3"></a><h2>Topic 2.1 Exercises</h2><br><b>* Exercise 1</b><dpecw1>

<br>
Try preparing for  file uploading in PHP.<br>
<ml_ins_href><ml_data_href>

</ml_data_href></ml_ins_href></dpecw1><br><dpecw2>

<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Step</b>

</th><th class="heading" scope="col">
<b>Action</b>

	</th></tr>
	<tr valign="top">
<td>
1
</td>
<td>
Open your <tt>php.ini</tt> file and adjust the File Uploads section so it allows for file uploads.
</td>
	</tr>
	<tr valign="top">
<td>
2
</td>
<td>
If you are running Windows, set the <tt>tmp_dir</tt> value to <tt>C:\tmp</tt>.
</td>
	</tr>
	<tr valign="top">
<td>
3
</td>
<td>
Adjust the maximum file size so it is 2MB.
</td>
	</tr>
	<tr valign="top">
<td>
4
</td>
<td>
Save the <tt>php.ini</tt> file and restart your Web server.
</td>
	</tr>
	<tr valign="top">
<td>
5
</td>
<td>
Create a <tt>tmp</tt> folder in C:\. Make sure the permissions are set so everyone can write to that directory.
</td>
	</tr>
	<tr valign="top">
<td>
6
</td>
<td>
Create a new directory called <tt>uploads</tt> where you want the files to be stored. Set the permissions so that only the Web server can write to it.
</td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw2><br>
<a name="phb036"></a>
<br><dpecw1>
	
In this lesson, you learned the PHP settings you use to allow file 
uploads in HTML forms. You learned the code in the PHP script that is 
used to allow uploads, establish file size, and determine where the 
uploaded files will be stored.<br>
In addition, you learned the steps you can take to secure the uploaded 
files by setting security permissions for the files' storage folder.
	
</dpecw1><br>
<a name="phc001"></a><br><a name="topic4"></a><h2>Lesson 3. Uploading PHP Files</h2><dpecw1>

To upload a file in PHP, you will need to create a script that checks 
that an HTML form has been submitted, ensures that the uploaded file is 
the proper type, and copies the file to the correct location.<br>
After completing this lesson, you should be able to:<br>
<ul>
	<li>
Identify the three necessary parts for file uploads in an HTML form
	</li>
	<li>
Create a PHP script that will select a file and store it in the specified directory
	</li>
</ul>

</dpecw1><br>
<a name="phc002"></a>
<br><dpecw1>

<b>* Creating PHP Upload Script</b><br>
Now that the server has (hopefully) been set up to properly allow for 
file uploads, you can create the PHP script that does the actual file 
handling. <br>
There are two parts to such a script: the HTML form and the PHP code.

</dpecw1><br>
<a name="phc003"></a>
<br><dpecw1>

The required syntax for a form to handle a file upload has three parts:<br>
<tt>&lt;form enctype=<b><tt>"</tt></b>multipart/form-data<b><tt>"</tt></b><br>
&nbsp;    action=<b><tt>"</tt></b>script.php<b><tt>"</tt></b> method=<b><tt>"</tt></b>post<b><tt>"</tt></b>&gt;<br>
&lt;input type=<b><tt>"</tt></b>hidden<b><tt>"</tt></b> name="MAX_FILE_SIZE<b><tt>"</tt></b><br>
&nbsp;    value=<b><tt>"</tt></b>30000<b><tt>"</tt></b> /&gt;<br>
File &lt;input type=<b><tt>"</tt></b>file<b><tt>"</tt></b> name=<b><tt>"</tt></b>upload<b><tt>"</tt></b> /&gt; </tt>

</dpecw1><br>
<a name="phc004"></a>
<br><dpecw1>

The <tt>enctype</tt> part of the initial form tag indicates that the form should be able to handle multiple types of data, including files.<br>
Omitting the <tt>enctype</tt> form attribute is a common reason for file uploads to mysteriously fail.<br>
Also note that the form <b>must</b><i> </i>use the <tt>POST</tt> method. 

</dpecw1><br><dpeccode>
<br>
<tt>&lt;form enctype=</tt><tt>"</tt><tt>multipart/form-data</tt><tt>"&nbsp;action=</tt><tt>"</tt><tt>script.php</tt><tt>"</tt><tt> method=</tt><tt>"</tt><tt>post</tt><tt>"</tt><tt>&gt;</tt><br>
</dpeccode>
<a name="phc005"></a>
<br><dpecw1>

The <tt>MAX_FILE_SIZE</tt> hidden input is a form restriction on how 
large the chosen file can be, in bytes, and must come before the file 
input. Finally, the <tt>file</tt> input type will create the proper button in the form. <br>
The <tt>MAX_FILE_SIZE</tt> is a restriction in the browser as to how 
large a file can be, although not all browsers abide by this 
restriction. The PHP configuration file has its own restrictions. You 
can also validate the uploaded file size within the receiving PHP 
script.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; &lt;input type=</tt><tt>"</tt><tt>hidden</tt><tt>"</tt><tt> name=</tt><tt>"</tt><tt>MAX_FILE_SIZE</tt><tt>"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value=</tt><tt>"</tt><tt>30000</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp; File &lt;input type=</tt><tt>"</tt><tt>file</tt><tt>"</tt><tt> name=</tt><tt>"</tt><tt>upload</tt><tt>"</tt><tt> /&gt;</tt><br>
</dpeccode><br>
<a name="phc006"></a>
<br><dpecw1>

<b>* The <tt>$_FILES</tt> Arra</b><b>* y</b><br>
As of PHP 4.1, the uploaded file can be accessed using the <tt>$_FILES</tt>
 superglobal. The variable will be an array of values. The data for an 
uploaded file will be available through these array elements:<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Index</b>

</th><th class="heading" scope="col">
<b>Meaning</b>

	</th></tr>
	<tr valign="top">
<td>
<tt>name</tt>
</td>
<td>
The original name of the file (as it was on the user's computer).
</td>
	</tr>
	<tr valign="top">
<td>
<tt>type</tt>
</td>
<td>
The MIME type of the file, as provided by the browser.
</td>
	</tr>
	<tr valign="top">
<td>
<tt>size</tt>
</td>
<td>
The size of the uploaded file in bytes.
</td>
	</tr>
	<tr valign="top">
<td>
<tt>tmp_name</tt>
</td>
<td>
The temporary filename of the uploaded file as it was stored on the server.
</td>
	</tr>
	<tr valign="top">
<td>
<tt>error</tt>
</td>
<td>
The error code associated with any problem in uploading.
</td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw1><br>
<a name="phc007"></a>
<br><dpecw1>

Once the file has been received by the PHP script, the <tt>move_uploaded_file()</tt>
 function can transfer it from the temporary directory to its permanent 
location. If the move was successful, then the temporary version of the 
file will have been moved over to its new destination.<br>
Windows users must use forward slashes or double backslashes to refer to directories (so <tt>C:\\</tt> or <tt>C/:</tt> rather than <tt>C:</tt>\). This is because the backslash is the escape character in PHP.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; move_uploaded_file ('</tt><i><tt>temporary_filename</tt></i><tt>'</tt><tt>,</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'/</tt><i><tt>path</tt></i><tt>/</tt><i><tt>to</tt></i><tt>/</tt><i><tt>destination</tt></i><tt>/</tt><i><tt>filename</tt></i><tt>');</tt><br>
</dpeccode><br>
<a name="phc008"></a>
<br><dpecw1>

<b>* Handling File Uploads</b><br>
This next script will let a user select a file on his computer and will then store it in the <tt>uploads</tt>
 directory. The script will check that the file is of an image type. 
Another script will list, and create links to, the uploaded images. <br>
Let's look at how on to handle file uploads in PHP on the following pages.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;?php # upload_image.php</tt><br>
<tt>&nbsp;&nbsp; </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Check if the form has been submitted.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (isset($_POST['submitted'])) {</tt><br>
<tt>&nbsp;&nbsp; </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Check for an uploaded file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (isset($_FILES['upload'])) {</tt><br>
<tt>&nbsp;&nbsp; </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Validate the type. Should be jpeg, jpg, or gif.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$allowed = array ('image/gif', 'image/jpeg', 'image/jpg', 'image/pjpeg');</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (in_array($_FILES['upload']['type'], $allowed)) {</tt><br>
</dpeccode><br>
<a name="phc009"></a>
<br><dpecjs><b>* Step 1</b>
<br>
Create a new PHP document in your text editor.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC </tt><tt>"</tt><tt>-//W3C//DTD XHTML 1.0 Transitional//EN</tt><tt>"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>"</tt><tt>http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&lt;html xmlns=</tt><tt>"</tt><tt>http://www.w3.org/1999/xhtml</tt><tt>"</tt><tt> xml:lang=en</tt><tt>"</tt><tt> lang=</tt><tt>"</tt><tt>en</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;title&gt;Upload an Image&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # upload_image.php</tt></dpeccode><br>
<a name="phc010"></a>
<br><dpecjs><b>* Step 2 </b>
<br>
Check if the form has been submitted and that a file was selected. Since
 this form will have no other fields to be validated, this is the only 
conditional required. 
You could also validate the size of the uploaded file to determine if it
 fits within the acceptable range (refer to the <tt>$_FILES['upload']['size']</tt> value). The existence of an uploaded file can also be validated with the <tt>is_uploaded_ file()</tt> function.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC </tt><tt>"</tt><tt>-//W3C//DTD XHTML 1.0 Transitional//EN</tt><tt>"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>"</tt><tt>http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&lt;html xmlns=</tt><tt>"</tt><tt>http://www.w3.org/1999/xhtml</tt><tt>"</tt><tt> xml:lang=en</tt><tt>"</tt><tt> lang=</tt><tt>"</tt><tt>en</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;title&gt;Upload an Image&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # upload_image.php</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Check if the form has been submitted.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if (isset($_POST[</tt><tt>'</tt><tt>submitted</tt><tt>'</tt><tt>])) {</tt><br>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Check for an uploaded file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (isset($_FILES[</tt><tt>'</tt><tt>upload</tt><tt>'</tt><tt>])) {</tt><br>
<br>
</dpeccode><br>
<a name="phc011"></a>
<br><dpecjs><b>* Step 3</b>
<br>
Check that the uploaded file is of the proper type.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC </tt><tt>"</tt><tt>-//W3C//DTD XHTML 1.0 Transitional//EN</tt><tt>"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>"</tt><tt>http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&lt;html xmlns=</tt><tt>"</tt><tt>http://www.w3.org/1999/xhtml</tt><tt>"</tt><tt> xml:lang=en</tt><tt>"</tt><tt> lang=</tt><tt>"</tt><tt>en</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;title&gt;Upload an Image&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # upload_image.php</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Check if the form has been submitted.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if (isset($_POST['submitted'])) {</tt><br>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Check for an uploaded file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (isset($_FILES['upload'])) {</tt><br>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Validate the type. Should be jpeg, jpg, or gif.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$allowed = array ('image/gif', 'image/jpeg', 'image/jpg', 'image/pjpeg');</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (in_array($_FILES['upload']['type'], $allowed)) {</tt><br>
<br>
</dpeccode><br>
<a name="phc012"></a>
<br><dpecw1>

The file's type is its MIME type, indicating what kind of file it is. 
The browser will determine and provide this information, depending upon 
the properties of the selected file. An image should have a type of 
image/gif, image/jpeg, or image/jpg (you could also allow for 
image/png).<br>
A file's MIME type can also be detected in PHP 4.3 and later using the <tt>mime_content_type()</tt> function.<br>
Microsoft Internet Explorer also uses the image/pjpeg for type, so you 
should allow for that. To validate the file's type, first create an 
array of allowed options. If the uploaded file's type is in this array, 
the file is valid and should be handled.

</dpecw1><br>
<a name="phc013"></a>
<br><dpecjs><b>* Step 4</b>
<br>
Copy the file to its new location on the server.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;// Check if the form has been submitted.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if (isset($_POST['submitted'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Check for an uploaded file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (isset($_FILES['upload'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Validate the type. Should be jpeg, jpg, or gif.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$allowed = array ('image/gif', 'image/jpeg', 'image/jpg', 'image/pjpeg');</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (in_array($_FILES['upload']['type'], $allowed)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Move the file over.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (move_uploaded_file($_FILES['upload']['tmp_name'], </tt><tt>"</tt><tt>uploads/{$_FILES['upload']['name']}</tt><tt>"</tt><tt>)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo
 '&lt;p&gt;The file has been uploaded!&lt;/p&gt;';</tt><br>
<br>
</dpeccode><br>
<a name="phc014"></a>
<br><dpecjs>Here we use the <tt>move_uploaded_file()</tt> function to move the temporary file to its permanent location (in the uploads folder). The file will retain its original name.
The <tt>move_uploaded_file()</tt> function will overwrite an existing 
file without warning if the new and existing files both have the same 
name. It is generally a good idea to give the file a new name.
As a rule, you should always use a conditional to confirm that a file 
was successfully moved, instead of just assuming that the move worked.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;// Check if the form has been submitted.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if (isset($_POST['submitted'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Check for an uploaded file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (isset($_FILES['upload'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Validate the type. Should be jpeg, jpg, or gif.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$allowed = array ('image/gif', 'image/jpeg', 'image/jpg', 'image/pjpeg');</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (in_array($_FILES['upload']['type'], $allowed)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Move the file over.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (move_uploaded_file($_FILES['upload']['tmp_name'], </tt><tt>"</tt><tt>uploads/{$_FILES['upload']['name']}</tt><tt>"</tt><tt>)) {</tt><br>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo
 '&lt;p&gt;The file has been uploaded!&lt;/p&gt;';</tt>
</dpeccode><br>
<a name="phc015"></a>
<br><dpecjs><b>* Step 5</b>
<br>
Report on any errors if the file could not be moved.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;The file could not be uploaded because: &lt;b&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print a message based upon the error.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch ($_FILES['upload']['error']) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 1:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'The file exceeds the upload_max_filesize setting in php.ini.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 2:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'The file exceeds the MAX_FILE_SIZE setting in the HTML form.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 3:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'The file was only partially uploaded.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 4:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'No file was uploaded.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 6:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'No temporary folder was available.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'A system error occurred.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} // End of switch.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print '&lt;/b&gt;&lt;/font&gt;.&lt;/p&gt;';</tt><br>
</dpeccode><br>
<a name="phc016"></a>
<br><dpecw1>

There are several possible reasons a file could not be moved. The first 
and most obvious one is if the permissions are not set properly on the 
destination directory.<br>
In such a case, you'll see an appropriate error message. PHP will often also store an error number in the <tt<tt>$_FILES['upload']['error'])
 variable. The numbers correspond to specific problems, from 0 to 4, 
plus 6 (oddly enough, there is no 5).<br>
The <tt>switch</tt> conditional here prints out the problem according to the error number. The default case is added because <tt>$_<tt>$_FILES['upload']['error'])</tt></tt> may not always have a value.

</tt<tt></dpecw1><br>
<a name="phc017"></a>
<br><dpecjs><b>* Step 6</b>
<br>
Complete the conditionals and the PHP section.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} // End of move... IF.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else { // Invalid type.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;Please upload a JPEG or GIF image.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink ($_FILES['upload']['tmp_name']); // Delete the file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} else { // No file uploaded.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;Please upload a JPEG or GIF image smaller than 512KB.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>} // End of the submitted conditional.</tt><br>
<tt>?&gt;</tt></dpeccode><br>
<a name="phc018"></a>
<br><dpecjs>The first <tt>else</tt> clause concludes the type <tt>in_array()</tt>
 conditional. If the file was not of the right type, an error message is
 printed. Also, the uploaded file is deleted from the server using the <tt>unlink()</tt> function.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} // End of move... IF.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else { // Invalid type.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;Please upload a JPEG or GIF image.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink ($_FILES['upload']['tmp_name']); // Delete the file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} else { // No file uploaded.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;Please upload a JPEG or GIF image smaller than 512KB.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>} // End of the submitted conditional.</tt><br>
<tt>?&gt;</tt></dpeccode><br>
<a name="phc019"></a>
<br><dpecjs>The second <tt>else</tt> clause concludes the <tt>isset($_FILES['upload'])</tt>
 conditional. That variable may not be set either because the user 
failed to select a file for uploading or because the file was larger 
than the <tt>MAX_FILE_SIZE</tt> value.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} // End of move... IF.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else { // Invalid type.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;Please upload a JPEG or GIF image.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink ($_FILES['upload']['tmp_name']); // Delete the file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} else { // No file uploaded.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;Please upload a JPEG or GIF image smaller than 512KB.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>} // End of the submitted conditional.</tt><br>
<tt>?&gt;</tt></dpeccode><br>
<a name="phc020"></a>
<br><dpecjs><b>* Step 7</b>
<br>
Create the HTML form.
This form is very simple, but it contains the three necessary parts for file uploads: the form's <tt>enctype</tt> attribute, the <tt>MAX_FILE_SIZE</tt> hidden input, and the file input.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;form enctype=</tt><tt>"</tt><tt>multipart/form-data</tt><tt>"</tt><br>
<tt>action=</tt><tt>"</tt><tt>upload_image.php</tt><tt>"</tt><tt> method=</tt><tt>"</tt><tt>post</tt><tt>"</tt><tt>&gt;</tt><br>
<br>
<tt>&nbsp;&nbsp;&nbsp;&lt;input type=</tt><tt>"</tt><tt>hidden</tt><tt>"</tt><tt> name=</tt>
<tt>"</tt><tt>MAX_FILE_SIZE</tt><tt>"</tt><tt> value=</tt><tt>"</tt><tt>524288</tt><tt>"</tt><tt> /&gt;</tt><br>
<br>
<tt>&nbsp;&nbsp;&nbsp;&lt;fieldset&gt;&lt;legend&gt;Select a JPEG or GIF image to be uploaded:&lt;/legend&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;b&gt;File:&lt;/b&gt; &lt;input type=</tt><tt>"</tt><tt>file</tt><tt>"</tt>
<tt>name=</tt><tt>"</tt><tt>upload</tt><tt>"</tt><tt> /&gt;&lt;/p&gt;</tt><br>
<br>
<tt>&nbsp;&nbsp;&nbsp;&lt;/fieldset&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;input type=</tt><tt>"</tt><tt>submit</tt><tt>"</tt><tt>name=</tt><tt>"</tt><tt>submit</tt><tt>"</tt><tt> value=</tt><tt>"</tt><tt>Submit</tt><tt>"</tt><tt> /&gt;&lt;/div&gt;</tt>
<tt>&nbsp;&nbsp;&nbsp;&lt;input type=</tt><tt>"</tt><tt>hidden</tt><tt>"</tt><tt>name=</tt><tt>"</tt><tt>submitted</tt><tt>"</tt><tt>value=</tt><tt>"</tt><tt>TRUE</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&lt;/form&gt;</tt><br>
</dpeccode><br>
<a name="phc021"></a>
<br><dpecjs><b>* Step 8</b>
<br>
Complete the HTML page.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&lt;form enctype="multipart/form-data"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>action="upload_image.php" method="post"&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&lt;input type="hidden" name=</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>"MAX_FILE_SIZE" value="524288" /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;fieldset&gt;&lt;legend&gt;Select a JPEG or GIF</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; image to be uploaded:&lt;/legend&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&lt;p&gt;&lt;b&gt;File:&lt;/b&gt; &lt;input type="file"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>name="upload" /&gt;&lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/fieldset&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;input type=</tt><tt>"</tt><tt>submit</tt><tt>"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; name=</tt><tt>"</tt><tt>submit</tt><tt>"</tt><tt> value=</tt><tt>"</tt><tt>Submit</tt><tt>"</tt><tt> /&gt;&lt;/div&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;input type=</tt><tt>"</tt><tt>hidden</tt><tt>"</tt><tt> name=</tt><tt>"</tt><tt>submitted</tt><tt>"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; value=</tt><tt>"</tt><tt>TRUE</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/form&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/body&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/html&gt;</tt>
<br>
<br>
</dpeccode><br>
<a name="phc022"></a>
<br><dpecw1>

<b>* Step 9</b><br>
Save the file as <tt>upload_image.php</tt>, upload to your Web server, and test in your Web browser.<br>
If the file was successfully uploaded and moved to its final 
destination, a simple message is printed. If an invalid file type is 
uploaded, an error message is displayed and the file is deleted (behind 
the scenes).

</dpecw1><br>
<a name="phc023"></a>
<br><dpecjs><b>* Complete Script</b>
<br>
This script allows user to upload an image file from her computer to the server.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC </tt><tt>"</tt><tt>-//W3C//DTD XHTML 1.0 Transitional//EN</tt><tt>"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>"</tt><tt>http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&lt;html xmlns=</tt><tt>"</tt><tt>http://www.w3.org/1999/xhtml</tt><tt>"</tt><tt> xml:lang=en</tt><tt>"</tt><tt> lang=</tt><tt>"</tt><tt>en</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Upload an Image&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # upload_image.php</tt><br>
<tt>// Check if the form has been submitted.</tt><br>
<tt>if (isset($_POST['submitted'])) {</tt><br>
<tt>&nbsp;&nbsp; // Check for an uploaded file.</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>if (isset($_FILES['upload'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Validate the type. Should be jpeg, jpg, or gif.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$allowed = array ('image/gif', 'image/jpeg', 'image/jpg', 'image/pjpeg');</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (in_array($_FILES['upload']['type'], $allowed)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Move the file over.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>if (move_uploaded_file($_FILES['upload']['tmp_name'], "uploads/{$_FILES['upload']['name']}")) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;The file has been uploaded!&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { // Couldn't move the file over.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;The file could not be uploaded because: &lt;b&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print a message based upon the error.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch ($_FILES['upload']['error']) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 1:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'The file exceeds the upload_max_filesize setting in php.ini.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 2:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'The file exceeds the MAX_FILE_SIZE setting in the HTML form.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 3:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'The file was only partially uploaded.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 4:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'No file was uploaded.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 6:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'No temporary folder was available.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; default:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'A system error occurred.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} // End of switch.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print '&lt;/b&gt;&lt;/font&gt;.&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} // End of move... IF.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else { // Invalid type.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 
'&lt;p&gt;&lt;font color="red"&gt;Please upload a JPEG or GIF 
image.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink ($_FILES['upload']['tmp_name']); // Delete the file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;} else { // No file uploaded.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;&lt;font 
color="red"&gt;Please upload a JPEG or GIF image smaller than 
512KB.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>} // End of the submitted conditional.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;form enctype="multipart/form-data"action="upload_image.php" method="post"&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>&lt;input type="hidden" name="MAX_FILE_SIZE" value="524288" /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;fieldset&gt;&lt;legend&gt;Select a JPEG or GIF image to be uploaded:&lt;/legend&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>&lt;p&gt;&lt;b&gt;File:&lt;/b&gt; &lt;input type="file"name="upload" /&gt;&lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/fieldset&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;input type=</tt><tt>"</tt><tt>submit</tt><tt>"</tt><tt>name=</tt><tt>"</tt><tt>submit</tt><tt>"</tt><tt> value=</tt><tt>"</tt><tt>Submit</tt><tt>"</tt><tt> /&gt;&lt;/div&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=</tt><tt>"</tt><tt>hidden</tt><tt>"</tt><tt> name=</tt><tt>"</tt><tt>submitted</tt><tt>"</tt><tt> value=</tt><tt>"</tt><tt>TRUE</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&lt;/form&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br>
<a name="phc024"></a>

<script language="JavaScript">insertAccQuestion('4','phc024.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phc025"></a>

<script language="JavaScript">insertAccQuestion('5','phc025.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phc028"></a>
<br><a name="topic5"></a><h2>Topic 3.1 Exercises</h2><br><b>* Exercise 1</b><dpecw1>

<br>
Try creating the script for uploading a file in PHP.

</dpecw1><br><dpecw2>

<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Step</b>

</th><th class="heading" scope="col">
<b>Action</b>

	</th></tr>
	<tr valign="top">
<td>
1
</td>
<td>
If you have not already done so, verify that your <tt>php.ini</tt> file allows file uploads.
</td>
	</tr>
	<tr valign="top">
<td>
2
</td>
<td>
Create a new PHP document.
</td>
	</tr>
	<tr valign="top">
<td>
3
</td>
<td>
Add the conditional to check if the form has been submitted and the file selected.
</td>
	</tr>
	<tr valign="top">
<td>
4
</td>
<td>
Create an array  that checks that the uploaded file is the proper type.
</td>
	</tr>
	<tr valign="top">
<td>
5
</td>
<td>
Indicate the new location on the server where the file should be copied to.
</td>
	</tr>
	<tr valign="top">
<td>
6
</td>
<td>
Add the code that reports on errors if the file cannot be moved, and complete the PHP section.
</td>
	</tr>
	<tr valign="top">
<td>
7
</td>
<td>
Create the HTML form with the three necessary parts for file uploads: the <tt><tt>enctype</tt></tt> attribute, the <tt><tt>MAX_FILE_SIZE</tt></tt> hidden input, and the <tt><tt>file</tt></tt> input.
</td>
	</tr>
	<tr valign="top">
<td>
8
</td>
<td>
Save the file as <tt>upload_image.php</tt>.
</td>
	</tr>
	<tr valign="top0">
<td>
9
</td>
<td>
<ml_ins_href><ml_data_href>php script.<br>
View your source code to see how it compares.
</ml_data_href></ml_ins_href></td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw2><br>
<br><a name="phc028a"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC </tt><tt>"</tt><tt>-//W3C//DTD XHTML 1.0 Transitional//EN</tt><tt>"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>"</tt><tt>http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&lt;html xmlns=</tt><tt>"</tt><tt>http://www.w3.org/1999/xhtml</tt><tt>"</tt><tt> xml:lang=en</tt><tt>"</tt><tt> lang=</tt><tt>"</tt><tt>en</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;title&gt;Upload an Image&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # upload_image.php</tt><br>
<tt>// Check if the form has been submitted.</tt><br>
<tt>if (isset($_POST['submitted'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Check for an uploaded file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;</tt><tt>if (isset($_FILES['upload'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Validate the type. Should be jpeg, jpg, or gif.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$allowed = array ('image/gif', 'image/jpeg', 'image/jpg', 'image/pjpeg');</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (in_array($_FILES['upload']['type'], $allowed)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Move the file over.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (move_uploaded_file($_FILES['upload']['tmp_name'], "uploads/{$_FILES</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;['upload']['name']}")) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;The file has been uploaded!&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else { // Couldn't move the file over.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;The file could not be uploaded because: &lt;b&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print a message based upon the error.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch ($_FILES['upload']['error']) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 1:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'The file exceeds the upload_max_filesize setting in php.ini.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 2:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'The file exceeds the MAX_FILE_SIZE setting in the HTML form.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 3:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'The file was only partially uploaded.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 4:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'No file was uploaded.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 6:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'No temporary folder was available.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print
 'A system error occurred.';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} // End of switch.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print '&lt;/b&gt;&lt;/font&gt;.&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} // End of move... IF.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} else { // Invalid type.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;Please upload a JPEG or GIF image.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unlink ($_FILES['upload']['tmp_name']); // Delete the file.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} else { // No file uploaded.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color=</tt><tt>"red"</tt><tt>&gt;Please upload a JPEG or GIF image smaller than 512KB.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>} // End of the submitted conditional.</tt><br>
<tt>?&gt;</tt>
<br>
<tt>&lt;form enctype=</tt><tt>"</tt><tt>multipart/form-data</tt><tt>"</tt><br>
<tt>action=</tt><tt>"</tt><tt>upload_image.php</tt><tt>"</tt><tt> method=</tt><tt>"</tt><tt>post</tt><tt>"</tt><tt>&gt;</tt><br>
<br>
<tt>&nbsp;&nbsp;&nbsp;&lt;input type=</tt><tt>"</tt><tt>hidden</tt><tt>"</tt><tt> name=</tt>
<tt>"</tt><tt>MAX_FILE_SIZE</tt><tt>"</tt><tt> value=</tt><tt>"</tt><tt>524288</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;fieldset&gt;&lt;legend&gt;Select a JPEG or GIF image to be uploaded:&lt;/legend&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;b&gt;File:&lt;/b&gt; &lt;input type=</tt><tt>"</tt><tt>file</tt><tt>"</tt>
<tt>name=</tt><tt>"</tt><tt>upload</tt><tt>"</tt><tt> /&gt;&lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;/fieldset&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;input type=</tt><tt>"</tt><tt>submit</tt><tt>"</tt><tt>name=</tt><tt>"</tt><tt>submit</tt><tt>"</tt><tt> value=</tt><tt>"</tt><tt>Submit</tt><tt>"</tt><tt> /&gt;&lt;/div&gt;</tt>
<tt>&nbsp;&nbsp;&nbsp;&lt;input type=</tt><tt>"</tt><tt>hidden</tt><tt>"</tt><tt>name=</tt><tt>"</tt><tt>submitted</tt><tt>"</tt><tt>value=</tt><tt>"</tt><tt>TRUE</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&lt;/form&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br><br>
<a name="phc029"></a>
<br><dpecw1>
	
In this lesson, you learned how to create a PHP script that verifies 
that an HTML form has been submitted, ensures that the uploaded file is 
the proper type, and copies the file to the correct location.<br>
In addition to the script commands necessary for these actions, you 
learned the required syntax for an HTML form to handle a file upload, 
and the <tt><tt>$_FILES</tt></tt> array elements that contain the file's data.
	
</dpecw1><br>
<a name="phd001"></a><br><a name="topic6"></a><h2>Lesson 4. Creating JavaScript</h2><dpecw1>

Despite their differences, PHP and JavaScript can be used together in an
 effective manner. This lesson discusses how PHP can be used to create 
or work with JavaScript just as PHP can create HTML. <br>
After completing this lesson, you should be able to:<br>
<ul>
	<li>
Identify the differences between working with PHP and working with JavaScript
	</li>
	<li>
Build a PHP script that can be used to create a JavaScript
	</li>
</ul>

</dpecw1><br>
<a name="phd002"></a>
<br><dpecw1>

<b>* PHP and JavaScript </b><br>
Despite its limitations and cross-browser compliance issues, JavaScript 
is still a very popular and useful technology in today's Web pages. 
Unfortunately, many new PHP programmers have difficulty grasping how PHP
 and JavaScript interact and differ. 

</dpecw1><br><dpecw2>

The most significant difference between the two languages is that 
JavaScript is client-side (meaning it runs in the Web browser) and PHP 
is server-side. Therefore, JavaScript can detect the size of the browser
 in pixels, create popup windows, and make image mouseovers, whereas PHP
 cannot. <br>
Not to belabor the point, but most everything Web developers do with 
JavaScript (for example, resize or move the browser window) cannot be 
done using the server-side PHP. There is <i>a little </i>overlap between the PHP and JavaScript. Both can set and read cookies, create HTML, and do some browser detection.

</dpecw2><br>
<a name="phd003"></a>
<br><dpecw1>
	
Sending data from PHP to JavaScript is rather easy — as simple as 
creating any HTML. Transferring data from JavaScript to PHP, however, is
 a bit more complicated. There are three obvious methods for doing so:<br>
<ul>
	<li>
Use JavaScript to set a cookie and then retrieve this cookie on another page using PHP.
	</li>
	<li>
Append the variable and value to a URL (e.g., <tt><tt>script.php?name=Jude</tt></tt>) with JavaScript, and then use JavaScript to redirect the Web browser to that URL.
	</li>
	<li>
Have JavaScript set the value of a hidden input type in an HTML form, and then have the user submit the form to the PHP script.
	</li>
</ul>
For example, if you wanted to determine the size of a browser window, 
you would need to first detect this in JavaScript (it cannot be done 
with PHP). If you wanted this information passed to a PHP script (to 
store in a database, maybe), you would need to use one of the preceding 
methods to accomplish this task.<br>
Notice that in every JavaScript-to-PHP transfer, one HTML page must use 
JavaScript to perform the detection and a separate PHP script must be 
used to receive the information. You cannot pass JavaScript data to PHP 
without requesting a PHP page from the server after JavaScript has done 
its thing.
	
</dpecw1><br>
<a name="phd004"></a>
<br><dpecw1>

<b>* Creating JavaScript with PHP</b><br>
While PHP cannot do certain things that JavaScript can, PHP can be used 
to create or work with JavaScript (just as PHP can create HTML). <br>
In this example, PHP will list all the images uploaded by the <tt>upload_image.php</tt>
 script and make clickable links using their names. The links themselves
 will call a JavaScript function that creates a popup window. 

</dpecw1><br>
<a name="phd005"></a>
<br><dpecjs>Three new PHP functions are used in this example. The first, <tt>getimagesize()</tt>, returns an array of information for a given image. <ml_ins_href><ml_data_href>
The second, <tt>scandir()</tt>, returns an array listing the files in a given directory (it was added in PHP 5). The third, <tt>filesize()</tt>, returns the size of a file in bytes.
<br>
</ml_data_href></ml_ins_href></dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $dir = 'uploads'; // Define the directory to view.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>$files = scandir($dir); // Read all the images into an array.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Display each image caption as a link to the JavaScript function.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>foreach ($files as $image) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; if (substr($image, 0, 1) != '.') { // Ignore anything starting with a period.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Get the image's size in pixels.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $image_size = </tt><tt>getimagesize</tt><tt>(</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Calculate the image's size in kilobytes.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $file_size = round ( (</tt><tt>filesize</tt><tt> (</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>)) / 1024) . </tt><tt>"</tt><tt>kb</tt><tt>"</tt><tt>;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Print the information.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>echo " &lt;tr&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&lt;td&gt;&lt;a href=\"javascript: create_window('$image',$image_ size[0],$image_size[1])\"&gt;$image&lt;/a&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&lt;td&gt;$file_size&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&lt;/tr&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; } </tt><br>
</dpeccode><br>
<br><a name="phd005a"></a>
<br><dpecw1>

<tt>getimagesize()</tt><b>*  Array</b><br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Element</b>

</th><th class="heading" scope="col">
<b>Value</b>

</th><th class="heading" scope="col">
<b>Example</b>

	</th></tr>
	<tr valign="top">
<td>
0
</td>
<td>
image's width in pixels
</td>
<td>
423
</td>
	</tr>
	<tr valign="top">
<td>
1
</td>
<td>
image's height in pixels
</td>
<td>
368
</td>
	</tr>
	<tr valign="top">
<td>
2
</td>
<td>
image's type
</td>
<td>
2 (representing JPG)
</td>
	</tr>
	<tr valign="top">
<td>
3
</td>
<td>
appropriate HTML img data
</td>
<td>
height="xx" width="yy"
</td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw1><br><br>
<a name="phd006"></a>
<br><dpecjs><b>* Step 1</b>
<br>
Begin a new PHP document in your text editor. This first script will 
display a list of images, along with their file sizes, and create a link
 to view the actual image itself in a popup window. The popup window 
will be created by JavaScript, although PHP will be used to set certain 
parameters.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!DOCTYPE html PUBLIC </tt><tt>"</tt><tt>-//W3C//DTD XHTML 1.0 Transitional//EN</tt><tt>"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>"</tt><tt>http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;html xmlns=</tt><tt>"</tt><tt>http://www.w3.org/1999/xhtml</tt><tt>"</tt><tt>xml:lang=</tt><tt>"</tt><tt>en</tt><tt>"</tt><tt> lang=</tt><tt>"</tt><tt>en</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Images&lt;/title&gt;</tt><br>
<br>
<br>
</dpeccode><br>
<a name="phd007"></a>
<br><dpecjs><b>* Step 2</b>
<br>
Begin the JavaScript function.The JavaScript <tt>create_window()</tt> 
function will accept three parameters: the image name, its width, and 
its height. Each of these will be passed to this function when the user 
clicks a link, the exact values of the image name, width, and height 
being determined by PHP. 
Some pixels will be added to the width and height values to create a 
window slightly larger than the image itself.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!DOCTYPE html PUBLIC </tt><tt>"</tt><tt>-//W3C//DTD XHTML 1.0 Transitional//EN</tt><tt>"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>"</tt><tt>http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;html xmlns=</tt><tt>"</tt><tt>http://www.w3.org/1999/xhtml</tt><tt>"</tt><tt>xml:lang=</tt><tt>"</tt><tt>en</tt><tt>"</tt><tt> lang=</tt><tt>"</tt><tt>en</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Images&lt;/title&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;script language=</tt><tt>"</tt><tt>JavaScript</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!- // Hide from old browsers.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Make a popup window function.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; function create_window (image, width, height) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Add some pixels to the width and height.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; width = width + 25;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; height = height + 50;</tt><br>
<br>
<br>
</dpeccode><br>
<a name="phd008"></a>
<br><dpecjs><b>* Step 3</b>
<br>
Resize the popup window if it is already open.
This code first checks if the popup window exists and if it is not 
closed. If it passes both tests (which is to say it's already open), the
 window will be resized according to the new image dimensions. The 
purpose of this code is to resize the existing window from one image to 
another if it was left open.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en"lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;title&gt;Images&lt;/title&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;script language=</tt><tt>"</tt><tt>JavaScript</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;!- // Hide from old browsers.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Make a popup window function.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;function create_window (image, width, height) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add some pixels to the width and height.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width = width + 25;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height = height + 50;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// If the window is already open, resize it to the new dimensions.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (window.popup_window &amp;&amp; </tt><tt>!</tt><tt>window.popup_window.closed) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.popup_window.resizeTo(width, height);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<br>
</dpeccode><br>
<a name="phd009"></a>
<br><dpecjs><b>* Step 4</b>
<br>
Determine the properties of the popup window and the URL, and then 
create the window.
The first line sets the properties of the popup window (the window will 
have no location bar, scroll bars, menus, or toolbars; it should be 
resizable; it will be located in the upper-left corner of the screen; 
and it will have a width of <tt><tt>width</tt></tt> and a height of <tt><tt>height</tt></tt>). The plus sign is used to perform concatenation in JavaScript, allowing you to add a variable's value to a string. 
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add some pixels to the width and height.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width = width + 25;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height = height + 50;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// If the window is already open, resize it to the new dimensions.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (window.popup_window &amp;&amp; </tt><tt>!</tt><tt>window.popup_window.closed) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.popup_window.resizeTo(width, height);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the window properties.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var window_specs = "location=no,
 scrollbars=no, menubars=no, toolbars=no, resizable=yes, left=0, top=0, 
width=" + width + ", height=" + height;</tt><br>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the URL.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var url = "image_window.php?image=" + image;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Create the popup window.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_window = window.open(url, "PictureWindow", window_specs);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_window.focus();</tt><br>
</dpeccode><br>
<a name="phd010"></a>
<br><dpecjs>The second line sets the URL of the popup window, which is <tt>image_window.php?image=</tt><i> </i>plus
 the name of the image. Finally, the popup window is created using the 
defined properties and URL, and focus is given to it, meaning it should 
appear above the current window.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add some pixels to the width and height.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width = width + 25;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height = height + 50;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// If the window is already open, resize it to the new dimensions.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (window.popup_window &amp;&amp; </tt><tt>!</tt><tt>window.popup_window.closed) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.popup_window.resizeTo(width, height);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the window properties.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var window_specs = "location=no,
 scrollbars=no, menubars=no, toolbars=no, resizable=yes, left=0, top=0, 
width=" + width + ", height=" + height;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the URL.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var url = "image_window.php?image=" + image;</tt><br>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Create the popup window.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_window = window.open(url, "PictureWindow", window_specs);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_window.focus();</tt><br>
</dpeccode><br>
<a name="phd011"></a>
<br><dpecjs><b>* Step 5</b>
<br>
Conclude the JavaScript function and the HTML head.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// If the window is already open, resize it to the new dimensions.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (window.popup_window &amp;&amp; </tt><tt>!</tt><tt>window.popup_window.closed) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.popup_window.resizeTo(width, height);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the window properties.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var window_specs = "location=no,
 scrollbars=no, menubars=no, toolbars=no, resizable=yes, left=0, top=0, 
width=" + width + ", height=" + height;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the URL.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var url = "image_window.php?image=" + image;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Create the popup window.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_window = window.open(url, "PictureWindow", window_specs);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_window.focus();</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of function.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;//--&gt;&lt;/script&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
</dpeccode><br>
<a name="phd012"></a>
<br><dpecw1>

<b>* Step 6</b><br>
Create the introductory text and begin the table.<br>
We're not putting a lot into the appearance of the example page. It will be just one table with a caption.

</dpecw1><br><dpeccode>
<br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;Click on an image to view it in a separate window.&lt;/div&gt;&lt;br /&gt;</tt><br>
<tt>&lt;table align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt> cellspacing=</tt><tt>"</tt><tt>5</tt><tt>"</tt><tt> cellpadding=</tt><tt>"</tt><tt>5</tt><tt>"</tt><tt> border=</tt><tt>"</tt><tt>1</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;tr&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;b&gt;Image Name&lt;/b&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;b&gt;Image Size&lt;/b&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;/tr&gt;</tt><br>
</dpeccode>
<a name="phd013"></a>
<br><dpecw1>

<b>* Step 7</b><br>
Start the PHP code and create an array of images by referring to the 
uploads directory. This script will automatically list and link all of 
the images stored in the uploads folder (presumably put there by <tt>upload_ image.php</tt>). Begin by defining the directory as a variable, so that it's easier to refer to. Then you would use the <tt>scandir()</tt> function, which returns an array of files and directories found within a folder. This array is assigned to <tt>$files</tt>. <br>
If you are not running PHP version 5 or later, see the manual's page for the <tt>scandir()</tt> function, which lists an alternative syntax you can use.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&lt;/tr&gt;</tt><br>
<tt>&lt;?php # images.php</tt><br>
<tt>//This script lists the images in the uploads directory.</tt><br>
<tt>$dir = 'uploads'; // Define the directory to view.</tt><br>
<tt>$files = scandir($dir); // Read all the images into an array.</tt><br>
</dpeccode>
<a name="phd014"></a>
<br><dpecjs><b>* Step 8</b>
<br>
Loop through the <tt>$files</tt> array, linking each image to the 
JavaScript function. This loop will go through every image in the array 
and create a row in the table for it. There are two PHP functions used 
here that you have not seen before (for more information on either, 
check the PHP manual): <tt>getimagesize()</tt> and <tt>filesize()</tt>. 
The former returns an array of information about an image. The values 
returned by this function will be used to set the width and height sent 
to the <tt>create_window()</tt> JavaScript function. 
<br>
</dpecjs><br><dpeccode>
<br>
<tt>// Display each image caption as a link to the JavaScript function.</tt><br>
<tt>foreach ($files as $image) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if (substr($image, 0, 1) != '.') { // Ignore anything starting with a period.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Get the image</tt><tt>'</tt><tt>s size in pixels.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$image_size = getimagesize(</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Calculate the image's size in kilobytes.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file_size = round ( (filesize (</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>)) / 1024) . </tt><tt>"</tt><tt>kb</tt><tt>"</tt><tt>;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print the information.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo " &lt;tr&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;a
 href=\"javascript: 
create_window('$image',$image_size[0],$image_size[1])\"&gt;$image&lt;/a&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;$file_size&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of the IF.</tt><br>
<tt>} // End of the foreach loop.</tt><br>
</dpeccode><br>
<a name="phd015"></a>
<br><dpecjs>The <tt>filesize()</tt> function returns the size of a file 
in bytes. To calculate the kilobytes of a file, divide this number by 
1,024 (there are that many bytes in a kilobyte) and round it off. 
Finally, the loop creates the HTML table row, consisting of the linked 
image name and the image size. The caption is linked as a call to the 
JavaScript <tt>create_window()</tt> function so that when the link is clicked, that function is executed.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>// Display each image caption as a link to the JavaScript function.</tt><br>
<tt>foreach ($files as $image) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if (substr($image, 0, 1) != '.') { // Ignore anything starting with a period.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Get the image</tt><tt>'</tt><tt>s size in pixels.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$image_size = getimagesize(</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Calculate the image's size in kilobytes.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file_size = round ( (filesize (</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>)) / 1024) . </tt><tt>"</tt><tt>kb</tt><tt>"</tt><tt>;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print the information.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo " &lt;tr&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;a
 href=\"javascript: 
create_window('$image',$image_size[0],$image_size[1])\"&gt;$image&lt;/a&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;$file_size&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of the IF.</tt><br>
<tt>} // End of the foreach loop.</tt><br>
</dpeccode><br>
<a name="phd016"></a>
<br><dpecjs><b>* Step 9</b>
<br>
Complete the PHP code and the HTML page.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>// Display each image caption as a link to the JavaScript function.</tt><br>
<tt>foreach ($files as $image) {</tt><br>
<tt> if (substr($image, 0, 1) != '.') { // Ignore anything starting with a period.</tt><br>
<tt>&nbsp;&nbsp; // Get the image's size in pixels.</tt><br>
<tt>&nbsp;&nbsp; $image_size = getimagesize(</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp; // Calculate the image's size in kilobytes.</tt><br>
<tt>&nbsp;&nbsp; $file_size = round ( (filesize (</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>)) / 1024) . </tt><tt>"</tt><tt>kb</tt><tt>"</tt><tt>;</tt><br>
<tt>&nbsp;&nbsp; // Print the information.</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>echo " &lt;tr&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&lt;td&gt;&lt;a href=\"javascript: create_window('$image',$image_size[0],$image_size[1])\"&gt;$image&lt;/a&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&lt;td&gt;$file_size&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>&lt;/tr&gt;";</tt><br>
<tt>&nbsp;&nbsp; } // End of the IF.</tt><br>
<tt>} // End of the foreach loop.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/table&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt><br>
</dpeccode><br>
<a name="phd017"></a>
<br><dpecjs><b>* Step 10</b>
<br>
Save the file as <tt>images.php</tt>, upload to your Web server (in the same directory as <tt>upload_image.php</tt>
 and the uploads folder), and test in your Web browser.
View the source code to see the dynamically generated links. Notice how 
the parameters to each function call are appropriate to the specific 
image. The <tt>getimagesize()</tt> function is used to determine the image's width and height.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>// Display each image caption as a link to the JavaScript function.</tt><br>
<tt>foreach ($files as $image) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if (substr($image, 0, 1) != '.') { // Ignore anything starting with a period.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Get the image</tt><tt>'</tt><tt>s size in pixels.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$image_size = getimagesize(</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Calculate the image's size in kilobytes.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file_size = round ( (filesize (</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>)) / 1024) . </tt><tt>"</tt><tt>kb</tt><tt>"</tt><tt>;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print the information.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo " &lt;tr&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;a
 href=\"javascript: 
create_window('$image',$image_size[0],$image_size[1])\"&gt;$image&lt;/a&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;$file_size&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of the IF.</tt><br>
<tt>} // End of the foreach loop.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/table&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt><br>
</dpeccode><br>
<a name="phd018"></a>
<br><dpecjs><b>* Full <tt></tt></b><tt>
<br>images.php</tt><b>*  Script</b>
Displayed here is the full <tt>images.php</tt> script, which uses JavaScript and PHP to create links to images stored on the server.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en"lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;title&gt;Images&lt;/title&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;script language=</tt><tt>"</tt><tt>JavaScript</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;!-- // Hide from old browsers.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Make a popup window function.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;function create_window (image, width, height) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add some pixels to the width and height.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width = width + 25;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height = height + 50;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// If the window is already open, resize it to the new dimensions.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (window.popup_window &amp;&amp; </tt><tt>!</tt><tt>window.popup_window.closed) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.popup_window.resizeTo(width, height);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the window properties.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var window_specs = "location=no, scrollbars=no, menubars=no, toolbars=no,</tt><br>
<tt>resizable=yes, left=0, top=0, width=" + width + ", height=" + height;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the URL.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var url = "image_window.php?image=" + image;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Create the popup window.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_window = window.open(url, "PictureWindow", window_specs);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_window.focus();</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of function.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;//--&gt;&lt;/script&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;Click on an image to view it in a separate window.&lt;/div&gt;&lt;br /&gt;</tt><br>
<tt>&lt;table align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt> cellspacing=</tt><tt>"</tt><tt>5</tt><tt>"</tt><tt> cellpadding=</tt><tt>"</tt><tt>5</tt><tt>"</tt><tt> border=</tt><tt>"</tt><tt>1</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;tr&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;b&gt;Image Name&lt;/b&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;b&gt;Image Size&lt;/b&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;/tr&gt;</tt><br>
<tt>&lt;?php # images.php</tt><br>
<tt>// This script lists the images in the uploads directory.</tt><br>
<tt>$dir = 'uploads'; // Define the directory to view.</tt><br>
<tt>$files = scandir($dir); // Read all the images into an array.</tt><br>
<tt>// Display each image caption as a link to the JavaScript function.</tt><br>
<tt>foreach ($files as $image) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if (substr($image, 0, 1) != '.') { // Ignore anything starting with a period.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Get the image</tt><tt>'</tt><tt>s size in pixels.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$image_size = getimagesize(</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Calculate the image's size in kilobytes.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file_size = round ( (filesize (</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>)) / 1024) . </tt><tt>"</tt><tt>kb</tt><tt>"</tt><tt>;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print the information.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo " &lt;tr&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;a
 href=\"javascript: 
create_window('$image',$image_size[0],$image_size[1])\"&gt;$image&lt;/a&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;$file_size&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of the IF.</tt><br>
<tt>} // End of the foreach loop.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/table&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br>
<a name="phd019"></a>
<br><dpecw1>

<b>* Making the Image Viewing Script</b><br>
The last step is to make the <tt>image_window.php</tt> script, which is used by the popup window. This script simply shows the image.

</dpecw1><br>
<a name="phd020"></a>
<br><dpecjs><b>* Step 1</b>
<br>
Begin a new PHP document in your text editor.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en"lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;title&gt;View Image&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
</dpeccode><br>
<a name="phd021"></a>
<br><dpecjs><b>* Step 2</b>
<br>
Begin the PHP section and create a new variable.
The <tt>$okay</tt> variable will be used to confirm that the image was 
displayed. If it could not be — because no valid image name was received
 by the script or because the image could not be accessed — <tt>$okay</tt> will still be <tt>FALSE</tt> and an error message will be displayed.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en"lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;title&gt;View Image&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # image_window.php</tt><br>
<tt>// Set a variable for problem reporting.</tt><br>
<tt>$okay = FALSE;</tt><br>
</dpeccode><br>
<a name="phd022"></a>
<br><dpecw1>

<b>* Step 3</b><br>
Validate the received image name. <br>
Before attempting to access the image on the server, it's a good idea to
 validate it twice. The first conditional just checks that an image 
value was sent to the page through the URL. The second conditional makes
 sure that the image name (i.e., the filename) has a valid extension (<tt>.jpg</tt>, <tt>jpeg</tt>, or <tt>.gif</tt>) by checking the last four characters of the received filename (notice that the four character extensions include jpeg<i> </i>without the initial period). To also allow for files with an extension of <tt>.JPG</tt>, <tt>.GIF</tt>, and .JPEG, call the <tt>strtolower()</tt> function.

</dpecw1><br><dpeccode>
<br>
<tt>// Make sure an image name was passed to the script.</tt><br>
<tt>if (isset($_GET['image'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Get the extension of the image name.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;$ext = substr ($_GET['image'], -4);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Test if it's a valid image extension.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if ((strtolower($ext) == '.jpg') OR (strtolower($ext) == 'jpeg') OR (strtolower($ext) == '.gif')) {</tt><br>
</dpeccode>
<a name="phd023"></a>
<br><dpecw1>

There are two assumptions being made here regarding the received image 
name. First, it shouldn't contain spaces or other problematic 
characters, as that will cause problems when passed in the URL. Second, 
assume that the image name has an extension. Alternatively, you could 
use the <tt>mime_content_type()</tt> function to check the file's type, regardless of the presence of an extension.<br>

</dpecw1><br><dpeccode>
<br>
<tt>// Make sure an image name was passed to the script.</tt><br>
<tt>if (isset($_GET['image'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Get the extension of the image name.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;$ext = substr ($_GET['image'], -4);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Test if it's a valid image extension.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if ((strtolower($ext) == '.jpg') OR (strtolower($ext) == 'jpeg') OR (strtolower($ext) == '.gif')) {</tt><br>
</dpeccode>
<a name="phd024"></a>
<br><dpecjs><b>* Step 4</b>
<br>
Display the image.
If the script can retrieve the image information, the image will be displayed (by creating the appropriate HTML code) and the <tt>$okay</tt> variable set to <tt>TRUE</tt>. The fourth array element returned by the <tt>getimagesize()</tt> function makes it easy to generate the proper HTML for the image.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;// Test if it's a valid image extension.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if ((strtolower($ext) == '.jpg') OR (strtolower($ext) == 'jpeg') OR (strtolower($ext) == '.gif')) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Get the image information and display the image.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($image = @getimagesize ('uploads/' . $_GET['image'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;img 
src=\"uploads/{$_GET['image']}\" $image[3] border=\"2\" /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$okay = TRUE; // No problems.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
</dpeccode><br>
<a name="phd025"></a>
<br><dpecjs><b>* Step 5</b>
<br>
Complete the conditionals and print an error message if necessary.
If <tt>$okay</tt> is not <tt>TRUE</tt>, then a problem occurred and a generic error message is returned to the Web browser.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;// Test if it's a valid image extension.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if ((strtolower($ext) == '.jpg') OR (strtolower($ext) == 'jpeg') OR (strtolower($ext) == '.gif')) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Get the image information and display the image.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($image = @getimagesize ('uploads/' . $_GET['image'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;img 
src=\"uploads/{$_GET['image']}\" $image[3] border=\"2\" /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$okay = TRUE; // No problems.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of extension IF.</tt><br>
<tt>} // End of isset() IF.</tt><br>
<tt>// If something went wrong...</tt><br>
<tt>if (!$okay) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;echo '&lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;font color=</tt><tt>"</tt><tt>red</tt><tt>"</tt><tt> size=</tt><tt>"</tt><tt>+1</tt><tt>"</tt><tt>&gt;This script must receive a valid image name!&lt;/font&gt;&lt;/div&gt;';</tt><br>
<tt>}</tt><br>
</dpeccode><br>
<a name="phd026"></a>
<br><dpecjs><b>* Step 6</b>
<br>
Complete the PHP code and the HTML page. This final bit of JavaScript 
will create a link that, when clicked, will close the popup window.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($image = @getimagesize ('uploads/' . $_GET['image'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;img 
src=\"uploads/{$_GET['image']}\" $image[3] border=\"2\" /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$okay = TRUE; // No problems.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of extension IF.</tt><br>
<tt>} // End of isset() IF.</tt><br>
<tt>// If something went wrong...</tt><br>
<tt>if (!$okay) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;echo '&lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;font color=</tt><tt>"</tt><tt>red</tt><tt>"</tt><tt> size=</tt><tt>"</tt><tt>+1</tt><tt>"</tt><tt>&gt;This script must receive a valid image name!&lt;/font&gt;&lt;/div&gt;';</tt><br>
<tt>}</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;br /&gt;</tt><br>
<tt>&lt;div align="center"&gt;&lt;a href="javascript:self.close();"&gt;Close This Window&lt;/a&gt;&lt;/div&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br>
<a name="phd027"></a>
<br><dpecjs><b>* Step 7</b>
<br>
Save the file as <tt>image_window.php</tt>, upload to your Web server (in the same directory as <tt>images.php</tt>), and test in your Web browser. 
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($image = @getimagesize ('uploads/' . $_GET['image'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;img 
src=\"uploads/{$_GET['image']}\" $image[3] border=\"2\" /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$okay = TRUE; // No problems.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of extension IF.</tt><br>
<tt>} // End of isset() IF.</tt><br>
<tt>// If something went wrong...</tt><br>
<tt>if (!$okay) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;echo '&lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;font color=</tt><tt>"</tt><tt>red</tt><tt>"</tt><tt> size=</tt><tt>"</tt><tt>+1</tt><tt>"</tt><tt>&gt;This script must receive a valid image name!&lt;/font&gt;&lt;/div&gt;';</tt><br>
<tt>}</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;br /&gt;</tt><br>
<tt>&lt;div align="center"&gt;&lt;a href="javascript:self.close();"&gt;Close This Window&lt;/a&gt;&lt;/div&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br>
<a name="phd028"></a>
<br><dpecjs><b>* Full <tt></tt></b><tt>
<br>image_window.php</tt><b>*  Script</b>
Displayed here is the full <tt>image_window.php</tt> script, which displays an image, using the <tt>getimagesize()</tt> function to determine its dimensions.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en"lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;title&gt;View Image&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # image_window.php</tt><br>
<tt>// Set a variable for problem reporting.</tt><br>
<tt>$okay = FALSE;</tt><br>
<tt>// Make sure an image name was passed to the script.</tt><br>
<tt>if (isset($_GET['image'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Get the extension of the image name.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;$ext = substr ($_GET['image'], -4);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Test if it's a valid image extension.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if ((strtolower($ext) == '.jpg') OR (strtolower($ext) == 'jpeg') OR (strtolower($ext) == '.gif')) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Get the image information and display the image.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($image = @getimagesize ('uploads/' . $_GET['image'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;img 
src=\"uploads/{$_GET['image']}\" $image[3] border=\"2\" /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$okay = TRUE; // No problems.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of extension IF.</tt><br>
<tt>} // End of isset() IF.</tt><br>
<tt>// If something went wrong...</tt><br>
<tt>if (!$okay) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;echo '&lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;font color=</tt><tt>"</tt><tt>red</tt><tt>"</tt><tt> size=</tt><tt>"</tt><tt>+1</tt><tt>"</tt><tt>&gt;This script must receive a valid image name!&lt;/font&gt;&lt;/div&gt;';</tt><br>
<tt>}</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;br /&gt;</tt><br>
<tt>&lt;div align="center"&gt;&lt;a href="javascript:self.close();"&gt;Close This Window&lt;/a&gt;&lt;/div&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br>
<a name="phd029"></a>
<br><dpecw1>
	
The PHP function <tt>file_exists()</tt> tests for the existence of a 
file on the server and could also be used in both of these scripts to 
validate the presence of an image before linking to or displaying it.
	
</dpecw1><br>
<a name="phd030"></a>

<script language="JavaScript">insertAccQuestion('6','phd030.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phd032"></a>

<script language="JavaScript">insertAccQuestion('7','phd032.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phd033"></a>

<script language="JavaScript">insertAccQuestion('8','phd033.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phd034"></a>

<script language="JavaScript">insertAccQuestion('9','phd034.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phd035"></a>
<br><a name="topic7"></a><h2>Topic 4.1 Exercises</h2><br><b>* Exercise 1</b><dpecw1>

<br>
Try creating a script that will list all uploaded images and make clickable links using their names in PHP.

</dpecw1><br><dpecw2>

<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Step</b>

</th><th class="heading" scope="col">
<b>Action</b>

	</th></tr>
	<tr valign="top">
<td>
1
</td>
<td>
Create a new PHP document in your text editor.
</td>
	</tr>
	<tr valign="top">
<td>
2
</td>
<td>
Begin a JavaScript <tt><tt>create_window()</tt></tt> function that will accept three image parameters: the image name, its width and its height.
</td>
	</tr>
	<tr valign="top">
<td>
3
</td>
<td>
Create the code that will resize the popup window if it is already open.
</td>
	</tr>
	<tr valign="top">
<td>
4
</td>
<td>
Use the <tt><tt>window_specs</tt></tt> variable to determine the properties of the popup window. Then determine the properties of the URL.<br>
Create the popup window using the defined properties and URL.
</td>
	</tr>
	<tr valign="top">
<td>
5
</td>
<td>
Conclude the Javascript function and the HTML header.
</td>
	</tr>
	<tr valign="top">
<td>
6
</td>
<td>
Create introductory text that says "Click on an image to view it in a separate window."
</td>
	</tr>
	<tr valign="top">
<td>
7
</td>
<td>
Create a two-column table with the column captions "Image Name" and "Image Size".
</td>
	</tr>
	<tr valign="top">
<td>
8
</td>
<td>
Start the PHP code and create an array of images by referring to the <tt>uploads</tt> directory. 
</td>
	</tr>
	<tr valign="top0">
<td>
9
</td>
<td>
Loop through the <tt>$files</tt> array, linking each image to the JavaScript function. 
</td>
	</tr>
	<tr valign="top1">
<td>
10
</td>
<td>
Complete the PHP code and the HTML page.
</td>
	</tr>
	<tr valign="top2">
<td>
11
</td>
<td>
Save the file as <tt><tt>images.php</tt></tt>.
</td>
	</tr>
	<tr valign="top3">
<td>
12
</td>
<td>
<ml_ins_href><ml_data_href>php script.<br>
View your source code to see how it compares.
</ml_data_href></ml_ins_href></td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw2><br>
<br><a name="phd035a"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en"lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;meta http-equiv=</tt><tt>"</tt><tt>content-type</tt><tt>"</tt><tt> content=</tt><tt>"</tt><tt>text/html; charset=iso-8859-1</tt><tt>"</tt><tt> /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;title&gt;Images&lt;/title&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;script language=</tt><tt>"</tt><tt>JavaScript</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;!-- // Hide from old browsers.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;// Make a popup window function.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;function create_window (image, width, height) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add some pixels to the width and height.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width = width + 25;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height = height + 50;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// If the window is already open, resize it to the new dimensions.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (window.popup_window &amp;&amp; </tt><tt>!</tt><tt>window.popup_window.closed) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;window.popup_window.resizeTo(width, height);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the window properties.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var window_specs = "location=no, scrollbars=no, menubars=no, toolbars=no,</tt><br>
<tt>resizable=yes, left=0, top=0, width=" + width + ", height=" + height;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the URL.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var url = "image_window.php?image=" + image;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Create the popup window.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_window = window.open(url, "PictureWindow", window_specs);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_window.focus();</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of function.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;//--&gt;&lt;/script&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;div align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;Click on an image to view it in a separate window.&lt;/div&gt;&lt;br /&gt;</tt><br>
<tt>&lt;table align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt> cellspacing=</tt><tt>"</tt><tt>5</tt><tt>"</tt><tt> cellpadding=</tt><tt>"</tt><tt>5</tt><tt>"</tt><tt> border=</tt><tt>"</tt><tt>1</tt><tt>"</tt><tt>&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;tr&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;b&gt;Image Name&lt;/b&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td align=</tt><tt>"</tt><tt>center</tt><tt>"</tt><tt>&gt;&lt;b&gt;Image Size&lt;/b&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&lt;/tr&gt;</tt><br>
<tt>&lt;?php # images.php</tt><br>
<tt>// This script lists the images in the uploads directory.</tt><br>
<tt>$dir = 'uploads'; // Define the directory to view.</tt><br>
<tt>$files = scandir($dir); // Read all the images into an array.</tt><br>
<tt>// Display each image caption as a link to the JavaScript function.</tt><br>
<tt>foreach ($files as $image) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;if (substr($image, 0, 1) != '.') { // Ignore anything starting with a period.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Get the image</tt><tt>'</tt><tt>s size in pixels.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$image_size = getimagesize(</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Calculate the image's size in kilobytes.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$file_size = round ( (filesize (</tt><tt>"</tt><tt>$dir/$image</tt><tt>"</tt><tt>)) / 1024) . </tt><tt>"</tt><tt>kb</tt><tt>"</tt><tt>;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Print the information.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo " &lt;tr&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;a
 href=\"javascript: 
create_window('$image',$image_size[0],$image_size[1])\"&gt;$image&lt;/a&gt;&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;$file_size&lt;/td&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;} // End of the IF.</tt><br>
<tt>} // End of the foreach loop.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/table&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br><br>
<a name="phd036"></a>
<br><br><b>* Exercise 2</b><dpecw1>

<br>
Try creating an image viewing script in PHP.

</dpecw1><br><dpecw2>

<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Step</b>

</th><th class="heading" scope="col">
<b>Action</b>

	</th></tr>
	<tr valign="top">
<td>
1
</td>
<td>
Create a new PHP document in your text editor.
</td>
	</tr>
	<tr valign="top">
<td>
2
</td>
<td>
Begin the PHP section and create a new variable.
</td>
	</tr>
	<tr valign="top">
<td>
3
</td>
<td>
Validate the received image name twice:<br>
Create a conditional that first checks that an image value was sent to the page through the URL.<br>
Create a second conditional that checks that the image has a valid 
extension by checking the last four characters of the filename.
</td>
	</tr>
	<tr valign="top">
<td>
4
</td>
<td>
Create code that displays the image.
</td>
	</tr>
	<tr valign="top">
<td>
5
</td>
<td>
Complete the conditionals and print an error message if necessary.
</td>
	</tr>
	<tr valign="top">
<td>
6
</td>
<td>
Complete the PHP code and the HTML page.
</td>
	</tr>
	<tr valign="top">
<td>
7
</td>
<td>
Save the file as <tt><tt>image_window.php</tt></tt>.
</td>
	</tr>
	<tr valign="top">
<td>
8
</td>
<td>
<ml_ins_href><ml_data_href>php script.<br>
View your source code to see how it compares.
</ml_data_href></ml_ins_href></td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw2><br>
<br><a name="phd036a"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>"</tt><tt>http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;View Image&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # image_window.php</tt><br>
<tt>// Set a variable for problem reporting.</tt><br>
<tt>$okay = FALSE;</tt><br>
<tt>// Make sure an image name was passed to the script.</tt><br>
<tt>if (isset($_GET['image'])) {</tt><br>
<tt>&nbsp;&nbsp; // Get the extension of the image name.</tt><br>
<tt>&nbsp;&nbsp; $ext = substr ($_GET['image'], -4);</tt><br>
<tt>&nbsp;&nbsp; // Test if it's a valid image extension.</tt><br>
<tt>&nbsp;&nbsp; if ((strtolower($ext) == '.jpg') OR (strtolower($ext) == 'jpeg') OR (strtolower($ext) == '.gif')) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Get the image information and display the image.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; if ($image = @getimagesize ('uploads/' . $_GET['image'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;img src=\"uploads/{$_GET['image']}\" $image[3] border=\"2\" /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$okay = TRUE; // No problems.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp; } // End of extension IF.</tt><br>
<tt>} // End of isset() IF.</tt><br>
<tt>// If something went wrong...</tt><br>
<tt>if (!$okay) {</tt><br>
<tt>&nbsp;&nbsp; echo '&lt;div align="center"&gt;&lt;font color="red" 
size="+1"&gt;This script must receive a valid image 
name!&lt;/font&gt;&lt;/div&gt;';</tt><br>
<tt>}</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;br /&gt;</tt><br>
<tt>&lt;div align="center"&gt;&lt;a href="javascript:self.close();"&gt;Close This Window&lt;/a&gt;&lt;/div&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br><br>
<a name="phd037"></a>
<br><dpecw1>
	
In this lesson, you learned the ways that PHP and JavaScript interact and differ. <br>
In addition, you learned how PHP can be used to create or work with JavaScript.<br>
To illustrate the ways that the two can work together, you learned to create a sample PHP script, <tt>images.php</tt>,
 that uses JavaScript and PHP to create links to images stored on the 
server. You also created an image viewing script that displays the image
 after determining the image dimensions.
	
</dpecw1><br>
<a name="phe001"></a><br><a name="topic8"></a><h2>Lesson 5. Using Output Buffering</h2><dpecw1>

Version 4 of PHP has added an output buffering feature, which lets you 
write and execute scripts that send data to the Web browser at specified
 points. This feature allows you to program your scripts in a more 
linear form.<br>
After completing this lesson, you should be able to:<br>
<ul>
	<li>
Describe the benefits of using the PHP output buffering feature
	</li>
	<li>
Create PHP scripts that utilize output buffering
	</li>
</ul>

</dpecw1><br>
<a name="phe002"></a>
<br><dpecw1>

<b>* Output Buffering</b><br>
An interesting feature added in version 4 of PHP is output control. <b>Output control</b><i> </i>(or <b>output buffering</b>)
 allows you to write and execute your scripts as normal but send data to
 the Web browser only at select points. The main benefit of this system 
is that you can call the <tt>header()</tt>, <tt>setcookie()</tt>, and <tt>session_start()</tt> functions at nearly any spot in your script without concern for the <tt>headers already sent</tt><i> </i>error messages. 

</dpecw1><br>
<a name="phe003"></a>
<br><dpecw1>

From a programmer's perspective, output buffering allows you to 
structure a script in a more linear form, without concern for HTTP 
headers. To demonstrate how you might use output buffering, we will 
create a straightforward version of a <tt>login.php</tt> script.

</dpecw1><br>
<a name="phe004"></a>
<br><dpecw1>

<b>* Step 1</b><br>
Create a new PHP document in your text editor.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;?php # login.php</tt><br>
</dpeccode>
<a name="phe005"></a>
<br><dpecw1>

<b>* Step 2</b><br>
Begin output buffering and close the PHP section. <br>
To begin output buffering, use the <tt>ob_start()</tt> function. Once you call it, every <tt>echo()</tt>, <tt>print()</tt>, and similar function will send data to a memory buffer rather than the Web browser. Conversely, HTTP calls (like <tt>header()</tt> and <tt>setcookie()</tt>) will not be buffered and will operate as usual. <br>
The key to using output buffering is to call the <tt>ob_start()</tt> function as early as possible in a script. It should be the very first line (not counting the opening PHP tag).

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;?php # login.php</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ob_start(); // Start output buffering.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ?&gt;</tt><br>
</dpeccode><br>
<a name="phe006"></a>
<br><dpecw1>

<b>* Step 3</b><br>
Add the HTML header.<br>
Since this code comes after output buffering has started, the HTML will 
be stored in memory, rather than sent to the Web browser. <br>
If you are using a template system in your page, you could include the header file here instead.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Login&lt;/title&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;body&gt;</tt><br>
</dpeccode>
<a name="phe007"></a>
<br><dpecw1>

<b>* Step 4</b><br>
Check if the form has been submitted and include the database connection script.<br>
In this script, assume that a <tt>mysql_connect.php</tt> script exists that establishes the database connection. That page should also define the <tt>escape_data()</tt> function. 

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Login&lt;/title&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;body&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;?php</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Check if the form has been submitted.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; if (isset($_POST['submitted'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; require_once ('./mysql_connect.php');</tt><br>
</dpeccode><br>
<a name="phe008"></a>
<br><dpecjs><b>* Step 5</b>
<br>
Validate the email address and password.
Instead of using an <tt>$errors</tt> array to handle errors, we can now 
directly print the messages. Each string will be added to the current 
buffer, rather than sent to the Web browser.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; // Connect to the db.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // The escape_data() function is defined in mysql_connect.php!</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Make sure that mysql_connect.php selects the 'sitename' database!</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Check for an email address.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; if (!empty($_POST['email'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $e = escape_data($_POST['email']);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; } else {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;&lt;font color="red"&gt;You forgot to enter your email address!&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $e = FALSE;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Check for a password.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; if (!empty($_POST['password'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $p = escape_data($_POST['password']);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; } else {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;&lt;font color="red"&gt;You forgot to enter your password!&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $p = FALSE;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; }</tt><br>
</dpeccode><br>
<a name="phe009"></a>
<br><dpecw1>

<b>* Step 6</b><br>
Query the database. Hopefully this part of the code is second nature to 
you by now. A query is run retrieving the user's ID and first name from 
the database, using the submitted email address and password in the <tt>WHERE</tt> conditional.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; if ($e &amp;&amp; $p) { // If everything's OK.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; /* Retrieve the user_id and first_name for</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; that email/password combination. */</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $query = "SELECT user_id, first_name FROM users WHERE email='$e' AND</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; password=SHA('$p')";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $result = @mysql_query ($query); // Run the query.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $row = mysql_fetch_array ($result, MYSQL_NUM); // Return a record, if</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; applicable.</tt><br>
</dpeccode>
<a name="phe010"></a>
<br><dpecw1>

<b>* Step 7</b><br>
If a match was made, store the data in the session, delete the buffer, and redirect the user.<br>
If the submitted email address and password match those in the database, then <tt>$row</tt> will have a value and we can register the first name and <tt>user_id</tt> values to the session. Thanks to output buffering, we can call the <tt>session_start()</tt> function here, even though there are HTML and echo statements in the preceding code.<br>
Since we won't be using the buffered text if the user is redirected, call the <tt>ob_end_clean()</tt> function before <tt>header()</tt>, which will delete the existing buffer and stop output buffering. Finally, the user is redirected to a <tt>loggedin.php</tt> page. 

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; if ($row) { // A record was pulled from the database.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Set the session data &amp; redirect.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; session_start();</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $_SESSION['user_id'] = $row[0];</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $_SESSION['first_name'] = $row[1];</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>ob_end_clean(); // Delete the buffer.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Redirect the user to the loggedin.php page.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Start defining the URL.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $url = 'http://' . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Check for a trailing slash.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; if ((substr($url, -1) == '/') OR (substr($url, -1) == '\\') ) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $url = substr ($url, 0, -1); // Chop off the slash.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Add the page.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $url .= '/loggedin.php';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; header("Location: $url");</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; exit(); // Quit the script.</tt><br>
</dpeccode>
<a name="phe011"></a>
<br><dpecw1>

<b>* Step 8</b><br>
Complete the <tt>($row)</tt> conditional.<br>
The <tt>$row</tt> variable could not have a value either because of a 
SQL/MySQL error or because an improper email address/password 
combination was entered. The first message here covers the second case 
and is what a public user should see. The second message is for your own
 debugging purposes and should not be part of a live application.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; } else { // No record matched the query.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;&lt;font color="red"&gt;The email address and password entered do not match</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;those on file.&lt;/font&gt;&lt;/p&gt;'; // Public message.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;&lt;font color="red"&gt;' . mysql_error() . '&lt;br /&gt;&lt;br /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; Query: ' . $query . '&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; }</tt><br>
</dpeccode>
<a name="phe012"></a>
<br><dpecw1>

<b>* Step 9</b><br>
Complete the <tt>($e &amp;&amp; $p)</tt> conditional, close the database connection, close the submit conditional, and close the PHP block.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; } else { // Errors!</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;&lt;font color="red"&gt;Please try again.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; } // End of if ($e &amp;&amp; $p) IF.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; mysql_close(); // Close the database connection.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; } // End of the main Submit conditional.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Display the form.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ?&gt;</tt><br>
</dpeccode>
<a name="phe013"></a>
<br><dpecw1>

<b>* Step 10</b><br>
Make the HTML form.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; &lt;h2&gt;Login&lt;/h2&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Display the form.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ?&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;h2&gt;Login&lt;/h2&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;form action="login.php" method="post"&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;Email Address: &lt;input type="text" name="email" size="20" maxlength="40"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
value="&lt;?php if (isset($_POST['email'])) echo $_POST['email']; ?&gt;"
 /&gt; &lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;Password: &lt;input type="password"name="password" size="20"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; maxlength="20"/&gt;&lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;&lt;input type="submit" name="submit"value="Login" /&gt;&lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;input type="hidden" name="submitted"value="TRUE" /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/form&gt;</tt><br>
</dpeccode>
<a name="phe014"></a>
<br><dpecw1>

<b>* Step 11</b><br>
Complete the HTML page and flush the buffer. The second to the last line
 of this script will send all of the accumulated data to the Web browser
 and turn off output buffering.<br>
At the conclusion of the script, call the <tt><tt>ob_end_flush()</tt></tt> function to send the accumulated buffer to the Web browser. Or, use the <tt>ob_end_clean()</tt>
 function to delete the buffered data without sending it. Both functions
 have the secondary effect of turning off output buffering.
<br>
<b>Tip:</b> PHP will automatically run <tt><tt>ob_end_flush()</tt></tt> at the conclusion of a script if it is not otherwise done.
<br>

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/body&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/html&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;?php</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ob_end_flush(); // Send everything to the Web browser.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ?&gt;</tt>
</dpeccode><br>
<a name="phe015"></a>
<br><dpecw1>

<b>* Step 12</b><br>
Save the file as <tt>login.php</tt>, upload to your Web server, and test in your Web browser.<br>
If any error messages occur, they are immediately printed and the form is displayed again.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/body&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/html&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;?php</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ob_end_flush(); // Send everything to the Web browser.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ?&gt;</tt><br>
</dpeccode>
<a name="phe016"></a>
<br><dpecjs><b>* Full <tt></tt></b><tt>
<br>login.php</tt><b>*  Script</b>
The <tt>login.php</tt> script can be written in a more logical structure without regard to HTTP headers, thanks to the use of output buffering.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;?php # login.php</tt><br>
<tt>ob_start(); // Start output buffering.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;Login&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php</tt><br>
<tt>// Check if the form has been submitted.</tt><br>
<tt>if (isset($_POST['submitted'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;require_once ('./mysql_connect.php');// Connect to the db.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;// The escape_data() function is defined in mysql_connect.php!</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;// Make sure that mysql_connect.php selects the 'sitename' database!</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;// Check for an email address.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;if (!empty($_POST['email'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $e = escape_data($_POST['email']);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;} else {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;&lt;font 
color="red"&gt;You forgot to enter your email 
address!&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $e = FALSE;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;// Check for a password.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;if (!empty($_POST['password'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $p = escape_data($_POST['password']);</tt><br>
<tt>&nbsp;&nbsp; } else {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font 
color="red"&gt;You forgot to enter your 
password!&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$p = FALSE;</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp; if ($e &amp;&amp; $p) { // If everything's OK.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Retrieve the user_id and first_name for that email/password combination. */</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query = "SELECT user_id, first_name FROM users WHERE email='$e' AND password=SHA('$p')";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result = @mysql_query ($query); // Run the query.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row = mysql_fetch_array ($result, MYSQL_NUM); // Return a record, if applicable.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($row) { // A record was pulled from the database.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the session data &amp; redirect.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session_start();</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SESSION['user_id'] = $row[0];</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SESSION['first_name'] = $row[1];</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>ob_end_clean(); // Delete the buffer.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Redirect the user to the loggedin.php page.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Start defining the URL.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = 
'http://' . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Check for a trailing slash.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((substr($url, -1) == '/') OR (substr($url, -1) == '\\') ) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $url = substr ($url, 0, -1); // Chop off the slash.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add the page.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= '/loggedin.php';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header("Location: $url");</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(); // Quit the script.</tt><br>
<tt>&nbsp;&nbsp;} else { // No record matched the query.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font 
color="red"&gt;The email address and password entered do not match those
 on file.&lt;/font&gt;&lt;/p&gt;'; // Public message.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font 
color="red"&gt;' . mysql_error() . '&lt;br /&gt;&lt;br /&gt;Query: ' . 
$query . '&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt> }</tt><br>
<tt>&nbsp;&nbsp;} else { // Errors!</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color="red"&gt;Please try again.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;} // End of if ($e &amp;&amp; $p) IF.</tt><br>
<tt>&nbsp;&nbsp;mysql_close(); // Close the database connection.</tt><br>
<tt>} // End of the main Submit conditional.</tt><br>
<tt>// Display the form.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;h2&gt;Login&lt;/h2&gt;</tt><br>
<tt>&lt;form action="login.php" method="post"&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Email Address: &lt;input type="text" name="email" size="20" maxlength="40"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; value="&lt;?php if (isset($_POST['email'])) echo $_POST['email']; ?&gt;" /&gt; &lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Password: &lt;input type="password"name="password" size="20" maxlength="20"/&gt;&lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;input type="submit" name="submit"value="Login" /&gt;&lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type="hidden" name="submitted"value="TRUE" /&gt;</tt><br>
<tt>&lt;/form&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt><br>
<tt>&lt;?php</tt><br>
<tt>ob_end_flush</tt><tt>()</tt><tt>; // Send everything to the Web browser.</tt><br>
<tt>?&gt;</tt><br>
</dpeccode><br>
<a name="phe017"></a>
<br><b><tt>ob_gzhandler()</tt>  <br>  </b>  As of PHP 4.0.4, you can send compressed output to browsers by starting output control with <tt>ob_start('ob_gzhandler')</tt>,
 minimizing the download size of your pages.   This function will 
determine the appropriate type of compression to use (gzip, deflate, or 
none) depending upon what the browser can accept.   Understand that 
compression is beneficial only on larger Web pages, and to use it, the <tt>output_buffering</tt> setting in the <tt>php.ini</tt> file must be set to Off.  <br><br>  <b><tt>ob_get_length()</tt>  <br>  </b>  Returns the length (in number of characters) of the current buffer.  <br><br>  <b><tt>ob_get_contents()</tt>  <br>  </b>  Returns the current buffer so that it may be assigned to a variable, should the need arise.  <br><br>  <b><tt>ob_flush()</tt>  <br>  </b>
  Sends the current contents of the buffer to the Web browser and then 
discards them, allowing a new buffer to be started. This function is new
 as of PHP 4.2.  <br><br>  <b><tt>ob_clean()</tt>  <br>  </b>  Deletes the current contents of the buffer without stopping the buffer process. This function is new as of PHP 4.2.  <br><br>  
<a name="phe018"></a>
<br><dpecw1>

<b>* Creating <tt></tt></b><tt>loggedin.php</tt><br>
For the entire process to work, a <tt>loggedin.php</tt> script is required, which we will now quickly write out.

</dpecw1><br>
<a name="phe019"></a>
<br><dpecw1>

<b>* Step 1</b><br>
Create a new PHP document in your text editor, beginning with the <tt>ob_start()</tt> function.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;?php # loggedin.php</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>ob_start</tt><tt>()</tt><tt>; // Start output buffering.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ?&gt;</tt><br>
</dpeccode><br>
<a name="phe020"></a>
<br><dpecw1>

<b>* Step 2</b><br>
Create the HTML header.<br>

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Logged In!&lt;/title&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;body&gt;</tt><br>
</dpeccode><br>
<a name="phe021"></a>
<br><dpecw1>

<b>* Step 3</b><br>
Start a session and see if the user is logged in.<br>
Similar to previous scripts, this page will check for the presence of a 
specific session variable as verification that the user is logged in. If
 so, he'll be greeted by name.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;?php</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; session_start(); // Start the session.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Greet the user by name, if possible.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; if (isset($_SESSION['first_name']) ) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo "&lt;p&gt;You are now logged in, {$_SESSION['first_name']}.&lt;/p&gt;";</tt><br>
</dpeccode><br>
<a name="phe022"></a>
<br><dpecw1>

<b>* Step 4</b><br>
Redirect the user if she is not logged in.<br>
This code mimics that in <tt>login.php</tt>, redirecting the user back to that page should she not already be logged in.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; } else { // If no session value is present, redirect the user.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>ob_end_clean</tt><tt>()</tt><tt>; // Delete the buffer.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Start defining the URL.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $url = 'http://' . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Check for a trailing slash.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; if ((substr($url, -1) == '/') OR (substr($url, -1) == '\\') ) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $url = substr ($url, 0, -1); // Chop off the slash.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $url .= '/login.php'; // Add the page.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; header("Location: $url");</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; exit(); // Quit the script.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; }</tt><br>
</dpeccode><br>
<a name="phe023"></a>
<br><dpecw1>

<b>* Step 5</b><br>
Finish the page.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;/body&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/html&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>ob_end_flush(); // Send everything to the Web browser.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ?&gt;</tt><br>
</dpeccode><br>
<a name="phe024"></a>
<br><dpecw1>

<b>* Step 6</b><br>
Save the page as <tt>loggedin.php</tt>, upload to your Web server (in the same directory as <tt>login.php</tt>), and test in your Web browser.<br>
If the user is logged in, he will be greeted by his first name. Anyone who attempts to access the <tt>loggedin.php</tt> page without first logging in will be redirected back to <tt>login.php</tt>.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;/body&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;/html&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>ob_end_flush(); // Send everything to the Web browser.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ?&gt;</tt><br>
</dpeccode><br>
<a name="phe025"></a>
<br><dpecjs><b>* Full <tt></tt></b><tt>
<br>loggedin.php</tt><b>*  Script</b>
This very simple version of <tt>loggedin.php</tt> makes use of output buffering and sessions.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;?php # loggedin.php</tt><br>
<tt>ob_start(); // Start output buffering.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Logged In!&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php</tt><br>
<tt>session_start(); // Start the session.</tt><br>
<tt>// Greet the user by name, if possible.</tt><br>
<tt>if (isset($_SESSION['first_name']) ) {</tt><br>
<tt>&nbsp;&nbsp; echo "&lt;p&gt;You are now logged in, {$_SESSION['first_name']}.&lt;/p&gt;";</tt><br>
<tt>} else { // If no session value is present, redirect the user.</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>ob_end_clean(); // Delete the buffer.</tt><br>
<tt>&nbsp;&nbsp; // Start defining the URL.</tt><br>
<tt>&nbsp;&nbsp; $url = 'http://' . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']);</tt><br>
<tt>&nbsp;&nbsp; // Check for a trailing slash.</tt><br>
<tt>&nbsp;&nbsp; if ((substr($url, -1) == '/') OR (substr($url, -1) == '\\') ) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = substr ($url, 0, -1); // Chop off the slash.</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp; $url .= '/login.php'; // Add the page.</tt><br>
<tt>&nbsp;&nbsp; header("Location: $url");</tt><br>
<tt>&nbsp;&nbsp; exit(); // Quit the script.</tt><br>
<tt>}</tt><br>
<tt>echo '&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;';</tt><br>
<tt>ob_end_</tt><tt>flush();</tt><tt> // Send everything to the Web browser.</tt><br>
<tt>?&gt;</tt>
</dpeccode><br>
<a name="phe026"></a>
<br><dpecw1>
	
The maximum buffer size can be set in the <tt>php.ini</tt> file. The default is 4,096 characters.
	
</dpecw1><br>
<a name="phe027"></a>

<script language="JavaScript">insertAccQuestion('10','phe027.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phe028"></a>

<script language="JavaScript">insertAccQuestion('11','phe028.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phe029"></a>

<script language="JavaScript">insertAccQuestion('12','phe029.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phe031"></a>

<script language="JavaScript">insertAccQuestion('13','phe031.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phe033"></a>
<br><a name="topic9"></a><h2>Topic 5.1 Exercises</h2><br><b>* Exercise 1</b><dpecw1>

<br>
Try using output buffering in a PHP script.

</dpecw1><br><dpecw2>

<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Step</b>

</th><th class="heading" scope="col">
<b>Action</b>

	</th></tr>
	<tr valign="top">
<td>
1
</td>
<td>
Create a new PHP document in your text editor.
</td>
	</tr>
	<tr valign="top">
<td>
2
</td>
<td>
Begin output buffering and close the PHP section.
</td>
	</tr>
	<tr valign="top">
<td>
3
</td>
<td>
Add the HTML header.
</td>
	</tr>
	<tr valign="top">
<td>
4
</td>
<td>
Check if the form has been submitted and include the database connection script.<br>
Assume that a <tt>mysql_connect.php</tt> script exists that establishes the database connection. That page should also define the <tt>escape_data()</tt> function. <ml_ins_href><ml_data_href>php script. 
</ml_data_href></ml_ins_href></td>
	</tr>
	<tr valign="top">
<td>
5
</td>
<td>
Validate the email address and password.
</td>
	</tr>
	<tr valign="top">
<td>
6
</td>
<td>
Query the database.
</td>
	</tr>
	<tr valign="top">
<td>
7
</td>
<td>
If a match was made, store the data in the session, delete the buffer using the <tt><tt>ob_end_clean()</tt></tt> function, and redirect the user to the <tt><tt>loggedin.php</tt></tt> page.
</td>
	</tr>
	<tr valign="top">
<td>
8
</td>
<td>
Complete the <tt>(<tt>$row</tt>)</tt> conditional.
</td>
	</tr>
	<tr valign="top0">
<td>
9
</td>
<td>
Complete the (<tt>$e &amp;&amp; $p</tt>) conditional, close the database connection, close the submit conditional, and close the PHP block.
</td>
	</tr>
	<tr valign="top1">
<td>
10
</td>
<td>
Make the HTML form.
</td>
	</tr>
	<tr valign="top2">
<td>
11
</td>
<td>
Complete the HTML page and flush the buffer.
</td>
	</tr>
	<tr valign="top3">
<td>
12
</td>
<td>
Save the file as <tt>login.php</tt>.
</td>
	</tr>
	<tr valign="top4">
<td>
13
</td>
<td>
<ml_ins_href><ml_data_href>php script.<br>
View your source code to see how it compares.
</ml_data_href></ml_ins_href></td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw2><br>
<br><a name="phe033a"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&lt;?php # login.php</tt><br>
<tt>ob_start(); // Start output buffering.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;Login&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php</tt><br>
<tt>// Check if the form has been submitted.</tt><br>
<tt>if (isset($_POST['submitted'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;require_once ('./mysql_connect.php');// Connect to the db.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;// The escape_data() function is defined in mysql_connect.php!</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;// Make sure that mysql_connect.php selects the 'sitename' database!</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;// Check for an email address.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;if (!empty($_POST['email'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $e = escape_data($_POST['email']);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;} else {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;&lt;font 
color="red"&gt;You forgot to enter your email 
address!&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $e = FALSE;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;// Check for a password.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;if (!empty($_POST['password'])) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $p = escape_data($_POST['password']);</tt><br>
<tt>&nbsp;&nbsp; } else {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font 
color="red"&gt;You forgot to enter your 
password!&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$p = FALSE;</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp; if ($e &amp;&amp; $p) { // If everything's OK.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Retrieve the user_id and first_name for that email/password combination. */</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$query = "SELECT user_id, first_name FROM users WHERE email='$e' AND password=SHA('$p')";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$result = @mysql_query ($query); // Run the query.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$row = mysql_fetch_array ($result, MYSQL_NUM); // Return a record, if applicable.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ($row) { // A record was pulled from the database.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Set the session data &amp; redirect.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;session_start();</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SESSION['user_id'] = $row[0];</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$_SESSION['first_name'] = $row[1];</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>ob_end_clean(); // Delete the buffer.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Redirect the user to the loggedin.php page.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Start defining the URL.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = 
'http://' . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Check for a trailing slash.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((substr($url, -1) == '/') OR (substr($url, -1) == '\\') ) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $url = substr ($url, 0, -1); // Chop off the slash.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Add the page.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url .= '/loggedin.php';</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header("Location: $url");</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(); // Quit the script.</tt><br>
<tt>&nbsp;&nbsp;} else { // No record matched the query.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font 
color="red"&gt;The email address and password entered do not match those
 on file.&lt;/font&gt;&lt;/p&gt;'; // Public message.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font 
color="red"&gt;' . mysql_error() . '&lt;br /&gt;&lt;br /&gt;Query: ' . 
$query . '&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt> }</tt><br>
<tt>&nbsp;&nbsp;} else { // Errors!</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;&lt;font color="red"&gt;Please try again.&lt;/font&gt;&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;} // End of if ($e &amp;&amp; $p) IF.</tt><br>
<tt>&nbsp;&nbsp;mysql_close(); // Close the database connection.</tt><br>
<tt>} // End of the main Submit conditional.</tt><br>
<tt>// Display the form.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;h2&gt;Login&lt;/h2&gt;</tt><br>
<tt>&lt;form action="login.php" method="post"&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Email Address: &lt;input type="text" name="email" size="20" maxlength="40"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; value="&lt;?php if (isset($_POST['email'])) echo $_POST['email']; ?&gt;" /&gt; &lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Password: &lt;input type="password"name="password" size="20" maxlength="20"/&gt;&lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;input type="submit" name="submit"value="Login" /&gt;&lt;/p&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type="hidden" name="submitted"value="TRUE" /&gt;</tt><br>
<tt>&lt;/form&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt><br>
<tt>&lt;?php</tt><br>
<tt>ob_end_flush</tt><tt>()</tt><tt>; // Send everything to the Web browser.</tt><br>
<tt>?&gt;</tt>
</dpeccode><br><br>
<br><a name="phe033b"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;?php # mysql_connect.php</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; //This file contains the database access information.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; //This file also establishes a connection to MySQL and selects the database.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; //Set the database access information on constants.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; DEFINE (</tt><tt>'</tt><tt>DB_USER</tt><tt>'</tt><tt>, </tt><tt>'</tt><i><tt>username</tt></i><tt>'</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; DEFINE (</tt><tt>'</tt><tt>DB_PASSWORD</tt><tt>'</tt><tt>, </tt><tt>'</tt><i><tt>password</tt></i><tt>'</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; DEFINE (</tt><tt>'</tt><tt>DB_HOST</tt><tt>'</tt><tt>, </tt><tt>'</tt><i><tt>localhost</tt></i><tt>'</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; DEFINE (</tt><tt>'</tt><tt>DB_NAME</tt><tt>'</tt><tt>, </tt><tt>'</tt><i><tt>sitename</tt></i><tt>'</tt><tt>);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; //Make the connection.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $dbc = @mysql_connect (DB_HOST, DB_USER, DB_PASSWORD) OR die </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; (</tt><tt>'</tt><tt>Could not connect to MySQL: </tt><tt>'</tt><tt> . mysql_error() );</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; //Select the database.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; @mysql_select_db (DB_NAME) OR die </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; (</tt><tt>'</tt><tt>Could not connect to MySQL: </tt><tt>'</tt><tt> . mysql_error() );</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; ?&gt;</tt><br>
</dpeccode><br><br>
<a name="phe034"></a>
<br><br><b>* Exercise 2</b><dpecw1>

<br>
Try adding output buffering to a second PHP script.

</dpecw1><br><dpecw2>

<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Step</b>

</th><th class="heading" scope="col">
<b>Action</b>

	</th></tr>
	<tr valign="top">
<td>
1
</td>
<td>
Create a new PHP document in your text editor, beginning with the <tt><tt>ob_start()</tt></tt> function.
</td>
	</tr>
	<tr valign="top">
<td>
2
</td>
<td>
Create the HTML header.
</td>
	</tr>
	<tr valign="top">
<td>
3
</td>
<td>
Start a session and see if the user is logged in.
</td>
	</tr>
	<tr valign="top">
<td>
4
</td>
<td>
Redirect the user to <tt><tt>login.php</tt></tt> if he is not logged in.
</td>
	</tr>
	<tr valign="top">
<td>
5
</td>
<td>
Finish the page.
</td>
	</tr>
	<tr valign="top">
<td>
6
</td>
<td>
Save the page as <tt><tt>loggedin.php</tt></tt>.
</td>
	</tr>
	<tr valign="top">
<td>
7
</td>
<td>
<ml_ins_href><ml_data_href>php script.<br>
View your source code to see how it compares.
</ml_data_href></ml_ins_href></td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw2><br>
<br><a name="phe034a"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&lt;?php # loggedin.php</tt><br>
<tt>ob_start(); // Start output buffering.</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;Logged In!&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php</tt><br>
<tt>session_start(); // Start the session.</tt><br>
<tt>// Greet the user by name, if possible.</tt><br>
<tt>if (isset($_SESSION['first_name']) ) {</tt><br>
<tt>&nbsp;&nbsp; echo "&lt;p&gt;You are now logged in, {$_SESSION['first_name']}.&lt;/p&gt;";</tt><br>
<tt>} else { // If no session value is present, redirect the user.</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>ob_end_clean(); // Delete the buffer.</tt><br>
<tt>&nbsp;&nbsp; // Start defining the URL.</tt><br>
<tt>&nbsp;&nbsp; $url = 'http://' . $_SERVER['HTTP_HOST'] . dirname($_SERVER['PHP_SELF']);</tt><br>
<tt>&nbsp;&nbsp; // Check for a trailing slash.</tt><br>
<tt>&nbsp;&nbsp; if ((substr($url, -1) == '/') OR (substr($url, -1) == '\\') ) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url = substr ($url, 0, -1); // Chop off the slash.</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp; $url .= '/login.php'; // Add the page.</tt><br>
<tt>&nbsp;&nbsp; header("Location: $url");</tt><br>
<tt>&nbsp;&nbsp; exit(); // Quit the script.</tt><br>
<tt>}</tt><br>
<tt>echo '&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;';</tt><br>
<tt>ob_end_</tt><tt>flush();</tt><tt> // Send everything to the Web browser.</tt><br>
<tt>?&gt;</tt>
</dpeccode><br><br>
<a name="phe035"></a>
<br><dpecw1>
	
In this lesson, you learned how the new PHP feature, output buffering, 
can be used in a PHP script to send data to the Web browser at select 
points. <br>
You learned to use the <tt><tt>ob_start()</tt></tt> function to begin output buffering and the <tt><tt>ob_end_flush()</tt></tt> function to send all accumulated data to the Web browser and turn off output buffering.<br>
Finally, you practiced writing simple PHP scripts that demonstrated how to use output buffering.
	
</dpecw1><br>
<a name="phf001"></a><br><a name="topic10"></a><h2>Lesson 6. Using the Improved MySQL Extension</h2><dpecw1>

PHP, version 5, contains a number of Improved MySQL Extension functions. You use these functions exactly as you do the standard <tt>mysql_*</tt> functions, but they are both faster and more secure than the basic MySQL functions.<br>
After completing this lesson, you should be able to:<br>
<ul>
	<li>
Identify the most important of the Improved MySQL Extension functions and their uses
	</li>
</ul>

</dpecw1><br>
<a name="phf002"></a>
<br><dpecw1>

<b>* MySQL Extensions Use New Features</b><br>
New to PHP as of version 5 is the Improved MySQL Extension functions, 
designed to take advantage of features added in MySQL 4.1 (they 
specifically work with MySQL 4.1.3 and later).<br>
If your server meets these requirements, you may want to consider using 
these functions in your PHP applications. Generally speaking, they are 
both faster and more secure than the basic MySQL functions.

</dpecw1><br>
<a name="phf003"></a>
<br><dpecw1>

To start, connect to MySQL using the <tt>mysqli_connect()</tt> function.<br>
<tt>$dbc = mysqli_connect ('localhost',<br>
&nbsp;    '<i>username</i>', '<i>password</i>'); </tt><br>
This function returns a resource representing the database connection. 
This resource will be used as an argument in most of the other <tt>mysqli_*</tt> functions.

</dpecw1><br>
<a name="phf004"></a>
<br><dpecw1>

<b>* Specifying the Database</b><br>
<tt>mysqli_connect()</tt> will let you also specify the database to select:<br>
<tt>$dbc = mysqli_connect ('<i>localhost</i>',<br>
&nbsp;    '<i>username</i>', '<i>password</i>', '<i>database</i>'); </tt><br>
Or you can use the <tt>mysqli_select_db()</tt> function:<br>
<tt>mysqli_select_db($dbc, '<i>database</i>');</tt> 

</dpecw1><br>
<a name="phf005"></a>
<br><dpecw1>

If a connection problem occurred, you can call the <tt>mysqli_connect_error()</tt> function, which returns the connection error message.<br>
<tt>mysqli_connect_error();</tt><br>
Note that this function is only for connection errors. The errors resulting from running queries can be reported by the <tt>mysqli_ error()</tt> function:<br>
<tt>mysqli_error($dbc);</tt>

</dpecw1><br>
<a name="phf006"></a>
<br><dpecw1>

<b>* Running Queries</b><br>
Once you've connected to MySQL and selected a database, you run queries using the <tt>mysqli_query()</tt> function:<br>
<tt>$result = mysqli_query($dbc, $query); </tt><br>
Notice that the syntax of this function places the database connection 
as the first argument and the query as the second, which is the opposite
 of the standard <tt>mysql_query()</tt> function. You'll also notice that whereas the database connection is an optional argument in most of the <tt>mysqli_*</tt><i> </i>functions, it's required with the Improved MySQL Extension. 

</dpecw1><br>
<a name="phf007"></a>
<br><dpecw1>

To handle the results returned by a <tt>SELECT</tt> query, use <tt>mysqli_fetch_array()</tt> in a <tt>while</tt> loop:<br>
<tt>while ($row = mysqli_fetch_array<br>
&nbsp;    ($result)) {<br>
// Do whatever with $row.<br>
} </tt>

</dpecw1><br><dpecw2>

As with <tt>mysql_fetch_array()</tt>, you can add a second parameter 
when calling this function, dictating how the returned array should be 
indexed. The options are: <tt>MYSQLI_NUM</tt>, for numeric (starting at 0); <tt>MYSQLI_ASSOC</tt>, for strings (using the column names); and <tt>MYSQLI_BOTH</tt>, for both. 

</dpecw2><br>
<a name="phf008"></a>
<br><dpecw1>

<b>* Working with Query Results</b><br>
You can count the number of returned records with<br>
<tt>$num = mysqli_num_rows($result);</tt><br>
And once you are finished with a query's results, you can release them and close the database connection:<br>
<tt>mysqli_free_result($result); <br>
mysqli_close($dbc); </tt>

</dpecw1><br>
<a name="phf009"></a>
<br><dpecw1>

These are the most important of the <tt>mysqli_*</tt> functions. There is also: <tt>mysqli_real_escape_string()</tt> for escaping problematic characters; <tt>mysqli_affected_rows()</tt>, which returns the number of rows affected by an <tt>INSERT</tt>, <tt>UPDATE</tt>, or <tt>DELETE</tt> query; a few functions related to using transactions; and about two or three dozen others, all listed in the PHP manual.<br>
Another benefit of the Improved MySQL Extension is that the <tt>mysqli_multi_query()</tt> function lets you execute multiple queries at one time.

</dpecw1><br>
<a name="phf010"></a>
<br><dpecw1>

For the most, part you'll use these functions exactly as you do the standard <tt>mysql_*</tt> functions. As a quick demonstration of this, let's write a script that retrieves all of the comments stored in the test<i> </i>database. <br>
Make sure you have a populated comments<i> </i>table and that you are running PHP 5 or later with MySQL 4.1.3 or later. 

</dpecw1><br>
<a name="phf011"></a>
<br><dpecw1>

<b>* Step 1</b><br>
Create a new PHP script in your text editor or IDE.

</dpecw1><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;View Submitted Comments&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # mysqli.php</tt><br>
</dpeccode><br>
<a name="phf012"></a>
<br><dpecw1>

<b>* Step 2</b><br>
Establish a connection to the database.<br>
This function will attempt to connect to MySQL and select the test<i> </i>database. If it succeeds, the result will be assigned to the <tt>$dbc</tt> variable. If the function call fails, the <tt>die()</tt> function will terminate the execution of the script, printing the connection error in the process. The <tt>mysqli_connect_error()</tt> function returns any errors that occur specifically while establishing a connection to MySQL.

</dpecw1><br><dpeccode>
<br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('localhost','username', 'password', 'test') 
OR die ('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
</dpeccode><br>
<a name="phf013"></a>
<br><dpecw1>

<b>* Step 3</b><br>
Define and execute the query.<br>
The query itself is the same as one you would use if you were working 
with the standard MySQL functions. This one retrieves all the records 
from the comments<i> </i>table in descending date entered order, 
formatting the date in the process. The execution of the query takes 
place in a conditional, so that you can report on any errors if there is
 a problem.

</dpecw1><br><dpeccode>
<br>
<tt>// Make the query.</tt><br>
<tt>$query = "SELECT name, comment, DATE_FORMAT(date_entered, '%M %D, %Y') FROM comments ORDER BY date_entered DESC";</tt><br>
<tt>// Run the query and handle the results.</tt><br>
<tt>if ($result = @mysqli_query($dbc, $query)) {</tt><br>
</dpeccode><br>
<a name="phf014"></a>
<br><dpecw1>

<b>* Step 4</b><br>
Print the query results.<br>
If at least one record was returned, we will use a <tt>while</tt> loop to print each record. The loop calls the <tt>mysqli_fetch_array()</tt> function, using the <tt>MYSQLI_NUM</tt>
 parameter so that it refers to the returned columns using numeric 
indexes. If no records were returned, a message stating such is printed.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; if (mysqli_num_rows($result) &gt; 0) { // Some records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print each record in a loop.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ($row = mysqli_fetch_array($result, MYSQLI_NUM)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "&lt;h3&gt;$row[0] ($row[2])&lt;/h3&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;$row[1]&lt;/p&gt;&lt;br /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp; } else { // No records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;There are currently no comments in the database.&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
</dpeccode><br>
<a name="phf015"></a>
<br><dpecw1>

<b>* Step 5</b><br>
Complete the page. The <tt>else</tt> clause is invoked if there was an 
error in executing the query. For debugging purposes, the MySQL error 
will be printed along with the query being run. If a non-connection 
error occurs, the error is printed out along with the query that was 
being run.<br>
Then the query results are freed and the database connection is closed. These are optional, but good, steps to take.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;} else { // Query didn't run properly.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;&lt;font color="red"&gt;MySQL Error: ' . mysqli_error($dbc) .</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; '&lt;br /&gt;&lt;br /&gt;Query: ' . $query .</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; '&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt>&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp;// Free the result and close the connection.</tt><br>
<tt>&nbsp;&nbsp;mysqli_free_result($result);</tt><br>
<tt>&nbsp;&nbsp;mysqli_close($dbc);</tt><br>
<tt>&nbsp;&nbsp;?&gt;</tt><br>
<tt>&nbsp;&nbsp;&lt;/body&gt;</tt><br>
<tt>&nbsp;&nbsp;&lt;/html&gt;</tt><br>
</dpeccode><br>
<a name="phf016"></a>
<br><dpecjs><b>* Step 6</b>
<br>
Save the page as <tt>mysqli.php</tt>, upload to your Web server, and test in your Web browser.
The Improved MySQL Extension functions are used here to retrieve and display some records from a database.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;View Submitted Comments&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # mysqli.php</tt><br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('localhost','username', 'password', 'test') OR die</tt><tt> </tt><tt>('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
<tt>// Make the query.</tt><br>
<tt>$query = "SELECT name, comment, DATE_FORMAT(date_entered, '%M %D, %Y') FROM comments ORDER BY date_entered DESC";</tt><br>
<tt>// Run the query and handle the results.</tt><br>
<tt>if ($result = @mysqli_query($dbc, </tt><tt>$query)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (mysqli_num_rows($result) &gt; 0) { // Some records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print each record in a loop.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>while ($row = mysqli_fetch_array($result, MYSQLI_NUM)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "&lt;h3&gt;$row[0] ($row[2])&lt;/h3&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;$row[1]&lt;/p&gt;&lt;br /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp; } else { // No records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;There are currently no comments in the database.&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>} else { // Query didn't run properly.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>echo '&lt;p&gt;&lt;font color="red"&gt;MySQL Error: ' . mysqli_error($dbc) .</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>'&lt;br /&gt;&lt;br /&gt;Query: ' . $query .</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>'&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt>}</tt><br>
<tt>// Free the result and close the connection.</tt><br>
<tt>mysqli_free_result($result);</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br>
<a name="phf017"></a>
<br><dpecw1>
	
You can use the Improved MySQL Extension in a procedural manner using 
functions, as in this example, or as an object, assuming you understand 
object-oriented programming.
	
</dpecw1><br>
<a name="phf018"></a>

<script language="JavaScript">insertAccQuestion('14','phf018.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phf019"></a>

<script language="JavaScript">insertAccQuestion('15','phf019.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phf020"></a>

<script language="JavaScript">insertAccQuestion('16','phf020.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phf021"></a>

<script language="JavaScript">insertAccQuestion('17','phf021.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phf022"></a>
<br><a name="topic11"></a><h2>Topic 6.1 Exercises</h2><br><b>* Exercise 1</b><dpecw1>

<br>
Try writing a script that retrieves all the comments stored in the test database using <tt>mysqli_*</tt> functions.

</dpecw1><br><dpecw2>

<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Step</b>

</th><th class="heading" scope="col">
<b>Action</b>

	</th></tr>
	<tr valign="top">
<td>
1
</td>
<td>
Create a new PHP document in your text editor.
</td>
	</tr>
	<tr valign="top">
<td>
2
</td>
<td>
Establish a connection to the database using the <tt>mysqli_connect()</tt> function.
</td>
	</tr>
	<tr valign="top">
<td>
3
</td>
<td>
Define and execute the query using the <tt>mysqli_query</tt> function.
</td>
	</tr>
	<tr valign="top">
<td>
4
</td>
<td>
Print the query results using the <tt>mysqli_fetch_array()</tt> function. Use the parameter that refers to the returned columns using numeric indexes.
</td>
	</tr>
	<tr valign="top">
<td>
5
</td>
<td>
Complete the page. Use the <tt>mysqli_*</tt> functions that release the query results and close the database connection.
</td>
	</tr>
	<tr valign="top">
<td>
6
</td>
<td>
Save the page as <tt><tt>mysqli.php</tt></tt>.
</td>
	</tr>
	<tr valign="top">
<td>
7
</td>
<td>
<ml_ins_href><ml_data_href>php script.<br>
View your source code to see how it compares.
</ml_data_href></ml_ins_href></td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw2><br>
<br><a name="phf022a"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;View Submitted Comments&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # mysqli.php</tt><br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('localhost','username', 'password', 'test') OR die</tt><tt> </tt><tt>('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
<tt>// Make the query.</tt><br>
<tt>$query = "SELECT name, comment, DATE_FORMAT(date_entered, '%M %D, %Y') FROM comments ORDER BY date_entered DESC";</tt><br>
<tt>// Run the query and handle the results.</tt><br>
<tt>if ($result = @mysqli_query($dbc, </tt><tt>$query)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (mysqli_num_rows($result) &gt; 0) { // Some records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print each record in a loop.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>while ($row = mysqli_fetch_array($result, MYSQLI_NUM)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "&lt;h3&gt;$row[0] ($row[2])&lt;/h3&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;$row[1]&lt;/p&gt;&lt;br /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp; } else { // No records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;There are currently no comments in the database.&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>} else { // Query didn't run properly.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>echo '&lt;p&gt;&lt;font color="red"&gt;MySQL Error: ' . mysqli_error($dbc) .</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>'&lt;br /&gt;&lt;br /&gt;Query: ' . $query .</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>'&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt>}</tt><br>
<tt>// Free the result and close the connection.</tt><br>
<tt>mysqli_free_result($result);</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br><br>
<a name="phf023"></a>
<br><dpecw1>
	
In this lesson, you learned about the Improved MySQL Extension functions available in PHP, version 5.<br>
You learned that you use these functions exactly as you do the standard <tt>mysql_*</tt> functions, and that they are both faster and more secure than the basic MySQL functions.<br>
Finally, you learned the most important of these functions, including the <tt>mysqli_connect()</tt> function, which connects you to MySQL; the <tt>mysqli_query()</tt> function, to run queries; and <tt>mysqli_close()</tt> to close the database connection. All these functions, plus many others, are listed in the PHP manual.
	
</dpecw1><br>
<a name="phg001"></a><br><a name="topic12"></a><h2>Lesson 7. New MySQL Features</h2><dpecw1>

There have been many upgrades to versions 4 and 4.1 of MySQL, where many
 new features have been added to the database application. Although you 
do not need to use these new features with every Web application you 
develop, they add significant improvements.<br>
This lesson discusses one of these new features, database transactions.<br>
After completing this lesson, you should be able to:<br>
<ul>
	<li>
Create new database transactions in mysql client
	</li>
	<li>
Roll back transaction queries to undo their effect on the database
	</li>
	<li>
Commit transaction queries to make the entire transaction permanent
	</li>
</ul>

</dpecw1><br>
<a name="phg002"></a>
<br><dpecw1>

<b>* MySQL Upgrades</b><br>
Versions 4 and 4.1 of MySQL have been significant upgrades, adding many 
new features to the database application. Although you do not need to 
use all of these new features with every Web application you develop, in
 the right circumstances they'll make a world of difference.<br>
First up are transactions, which require the InnoDB storage engine. If 
you are using version 4.0 or later, you should have the InnoDB type 
available to you. 

</dpecw1><br>
<a name="phg003"></a>
<br><dpecw1>

A <b>database transaction</b> is a sequence of queries run during a 
single session. For example, you might insert a record into one table, 
insert another record into another table, and maybe run an update. <br>
Without using transactions, each individual query takes effect 
immediately and cannot be undone. With transactions, you can set start 
and stop points and then enact or retract all of the queries as needed 
(for example, if one query failed, all of the queries can be undone). 
<br>
<b>Tip:</b> One of the great features of transactions is that they offer
 protection should a random event occur, such as a server crash. Either a
 transaction is executed in its entirety or all of the changes are 
ignored.
<br>

</dpecw1><br>
<a name="phg004"></a>
<br><dpecw1>

Commercial interactions commonly require transactions, even something as
 basic as transferring $100 from another bank account to yours. What 
seems like a simple process is actually several steps:<br>
<ul>
	<li>
Confirm that there is  $100 in the other account.
	</li>
	<li>
Decrease that account by $100.
	</li>
	<li>
Increase the amount of money in your account by $100.
	</li>
	<li>
Verify that the increase worked. 
	</li>
</ul>
<br>
If any of the steps failed, you would want to undo all of them. For 
example, if the money couldn't be deposited in your account, it should 
be returned to the other until the entire transaction can go through. 

</dpecw1><br>
<a name="phg005"></a>
<br><dpecw1>

<b>* Starting a Transaction</b><br>
To perform transactions with MySQL, you must use the InnoDB table type 
(or storage engine). To begin a new transaction in the mysql client, 
type<br>
<tt>START TRANSACTION;</tt><br>
If you are using a version of MySQL prior to 4.0.11, you must use just <tt>BEGIN</tt> instead. Once your transaction has begun, you can now run your queries. Once you have finished, you can either enter <tt>COMMIT</tt> to enact all of the queries or <tt>ROLLBACK</tt> to undo the effect of all of the queries. 
<br>
<b>Tip:</b> As of MySQL 4.0.14 and 4.1.1, you can create savepoints in transactions: <tt>SAVEPOINT <i>savepoint_name</i>;</tt> Then you can roll back to that point: <tt>ROLLBACK TO SAVEPOINT <i>savepoint_name</i>;</tt>
<br>

</dpecw1><br>
<a name="phg006"></a>
<br><dpecw1>

After you have either committed or rolled back the queries, the transaction is considered complete, and MySQL returns to an <b>autocommit</b> mode. This means that any queries you execute take immediate effect. To start another transaction, just type <tt>START TRANSACTION;</tt> (or <tt>BEGIN</tt>). <br>
To alter MySQL's autocommit nature, type <tt>SET AUTOCOMMIT=0;</tt>. Then you do not need to type <tt>START TRANSACTION;</tt> and no queries will be permanent until you type <tt>COMMIT</tt> (or use an <tt>ALTER</tt>, <tt>CREATE</tt>, etc., query).

</dpecw1><br>
<a name="phg007"></a>
<br><dpecw1>

It is important to know that certain types of queries cannot be rolled 
back. Specifically those that create, alter, truncate (empty) or delete 
tables or create or delete databases cannot be undone. Furthermore, 
using such a query has the effect of committing and ending the current 
transaction. <br>
Finally, you should understand that transactions are particular to each 
connection. So one user connected through the mysql client has a 
different transaction than another mysql client user, both of which are 
different than a connected PHP script.

</dpecw1><br>
<a name="phg008"></a>
<br><dpecjs>With these points in mind, let's run through a very trivial use of transactions within the mysql client here.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; mysql&gt; START TRANSACTION</tt><br>
<tt>&nbsp;&nbsp; Query OK, 0 rows affected (0.00 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance-100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=2;</tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance+100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=1; </tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; COMMIT;</tt><br>
<tt>&nbsp;&nbsp; Query OK, 0 rows affected (0.07 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; SELECT * FROM accounts;</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; " id " name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; " balance&nbsp;&nbsp; "</tt><br>
<tt>&nbsp;&nbsp; " 1&nbsp;&nbsp;" Tom Vasquez&nbsp;&nbsp;"&nbsp;&nbsp; 5560.23 "</tt><br>
<tt>&nbsp;&nbsp; " 2&nbsp;&nbsp;" Dick Mancini " 909225.24 "</tt><br>
<tt>&nbsp;&nbsp; " 3&nbsp;&nbsp;" Harry Wu&nbsp;&nbsp;&nbsp;&nbsp; "&nbsp;&nbsp;&nbsp;&nbsp;892.00 "</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; 3 rows in set (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; </tt>
</dpeccode><br>
<a name="phg009"></a>
<br><dpecw1>

<b>* Step 1</b><br>
Connect to the mysql client and select the <tt>test</tt><i> </i>database. <br>
Since this is just a demonstration, we'll use the all-purpose <tt>test</tt><i> </i>database.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; Enter password: ********</tt><br>
<tt>&nbsp;&nbsp; Welcome to the MySQL monitor. Commands end with ; or \g.</tt><br>
<tt>&nbsp;&nbsp; Your MySQL connection id is 3 to server version : 4.1.10-nt</tt><br>
<tt>&nbsp;&nbsp; Type 'help;' or '\h' for help. Type '\c' to clear the buffer.</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; USE test;</tt><br>
<tt>&nbsp;&nbsp; Database changed</tt>
</dpeccode><br>
<a name="phg010"></a>
<br><dpecw1>

<b>* Step 2</b><br>
Create a new <tt>accounts</tt><i> </i>table. Obviously this isn't a 
complete table or database design. For starters, normalization would 
require that the user's name be separated into multiple columns, if not 
stored in a separate table altogether. But for demonstration purposes, 
this will be fine.<br>
The most important aspect of the table definition is its engine — InnoDB, which allows for transactions.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; Enter password: ********</tt><br>
<tt>&nbsp;&nbsp; Welcome to the MySQL monitor. Commands end with ; or \g.</tt><br>
<tt>&nbsp;&nbsp; Your MySQL connection id is 3 to server version : 4.1.10-nt</tt><br>
<tt>&nbsp;&nbsp; Type 'help;' or '\h' for help. Type '\c' to clear the buffer.</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; USE test;</tt><br>
<tt>&nbsp;&nbsp; Database changed</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; CREATE TABLE accounts (</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; id INT UNSIGNED NOT NULL AUTO_INCREMENT,</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; name VARCHAR(40) NOT NULL,</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance DECIMAL(10,2) NOT NULL DEFAULT 0.0,</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; PRIMARY KEY (id)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; ) ENGINE=InnoDB;</tt><br>
<tt>&nbsp;&nbsp; Query OK, 0 rows affected (2.86 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; </tt>
</dpeccode><br>
<a name="phg011"></a>
<br><dpecw1>

<b>* Step 3</b><br>
Populate the <tt>accounts</tt> table.<br>
You can use whatever names and values here that you want. The important 
thing to note is that MySQL will automatically commit this query, as no 
transaction has begun yet.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; mysql&gt; INSERT INTO accounts (name, balance)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; VALUES ('Tom Vasquez', 5460.23),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; ('Dick Mancini', 909325.24),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; ('Harry Wu', 892.00); </tt><br>
<br>
<br>
</dpeccode><br>
<a name="phg012"></a>
<br><dpecw1>

<b>* Step 4</b><br>
Begin a transaction and show the current <tt>accounts</tt> table contents.<br>
Again, if you are using an earlier version of MySQL you'll need to use just <tt>BEGIN</tt> instead of <tt>START TRANSACTION</tt>.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; mysql&gt; START TRANSACTION; </tt><br>
<tt>&nbsp;&nbsp; Query OK, 0 rows affected (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; SELECT * FROM accounts;</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; " id " name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; " balance&nbsp;&nbsp; "</tt><br>
<tt>&nbsp;&nbsp; " 1&nbsp;&nbsp;" Tom Vasquez&nbsp;&nbsp;"&nbsp;&nbsp; 5460.23 "</tt><br>
<tt>&nbsp;&nbsp; " 2&nbsp;&nbsp;" Dick Mancini " 909325.24 "</tt><br>
<tt>&nbsp;&nbsp; " 3&nbsp;&nbsp;" Harry Wu&nbsp;&nbsp;&nbsp;&nbsp; "&nbsp;&nbsp;&nbsp;&nbsp;892.00 "</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; 3 rows in set (0.13 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; </tt>
</dpeccode><br>
<a name="phg013"></a>
<br><dpecw1>

<b>* Step 5</b><br>
Subtract $100 from Dick Mancini's (or any user's) account.<br>
Using an <tt>UPDATE</tt> query, a little math, and a <tt>WHERE</tt> 
conditional, you can subtract 100 from a balance. Although MySQL will 
indicate that one row was affected, the effect is not permanent until 
the transaction is committed.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance-100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=2;</tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.11 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt><br>
</dpeccode><br>
<a name="phg014"></a>
<br><dpecw1>

<b>* Step 6</b><br>
Add $100 to Tom Vasquez's account.<br>
This is the opposite of Step 5, as if $100 were being transferred from the one person to the other.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance-100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=2;</tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.11 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance+100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=1; </tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt>
</dpeccode><br>
<a name="phg015"></a>
<br><dpecjs><b>* Step 7</b>
<br>
Confirm the results. Two <tt>UPDATE</tt> queries are executed and the results are viewed. One balance is 100 more and the other is 100 less then they originally were.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance-100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=2;</tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.11 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance+100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=1; </tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; SELECT * FROM accounts; </tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; " id " name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; " balance&nbsp;&nbsp; "</tt><br>
<tt>&nbsp;&nbsp; " 1&nbsp;&nbsp;" Tom Vasquez&nbsp;&nbsp;"&nbsp;&nbsp; </tt><tt>5560.23</tt><tt> "</tt><br>
<tt>&nbsp;&nbsp; " 2&nbsp;&nbsp;" Dick Mancini " </tt><tt>909225.24</tt><tt> "</tt><br>
<tt>&nbsp;&nbsp; " 3&nbsp;&nbsp;" Harry Wu&nbsp;&nbsp;&nbsp;&nbsp; "&nbsp;&nbsp;&nbsp;&nbsp;892.00 "</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; 3 rows in set (0.00 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; </tt>
</dpeccode><br>
<a name="phg016"></a>
<br><dpecjs><b>* Step 8</b>
<br>
Roll back the transaction.
To demonstrate how transactions can be undone, let's undo the effects of these queries. The <tt>ROLLBACK</tt>
 commands returns the database back to how it was prior to starting the 
transaction. The command also terminates the transaction, returning 
MySQL to its autocommit mode.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; mysql&gt; SELECT * FROM accounts; </tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; " id " name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; " balance&nbsp;&nbsp; "</tt><br>
<tt>&nbsp;&nbsp; " 1&nbsp;&nbsp;" Tom Vasquez&nbsp;&nbsp;"&nbsp;&nbsp; 5560.23 "</tt><br>
<tt>&nbsp;&nbsp; " 2&nbsp;&nbsp;" Dick Mancini " 909225.24 "</tt><br>
<tt>&nbsp;&nbsp; " 3&nbsp;&nbsp;" Harry Wu&nbsp;&nbsp;&nbsp;&nbsp; "&nbsp;&nbsp;&nbsp;&nbsp;892.00 "</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; 3 rows in set (0.00 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; ROLLBACK; </tt><br>
<tt>&nbsp;&nbsp; Query OK, 0 rows affected (0.20 sec)</tt><br>
<br>
<br>
</dpeccode><br>
<a name="phg017"></a>
<br><dpecjs><b>* Step 9</b>
<br>
Confirm the results. The query should reveal the contents of the table as they original were.
Because we used the <tt>ROLLBACK</tt> command, the potential effects of the <tt>UPDATE</tt> queries were ignored.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; mysql&gt; SELECT * FROM accounts; </tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; " id " name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; " balance&nbsp;&nbsp; "</tt><br>
<tt>&nbsp;&nbsp; " 1&nbsp;&nbsp;" Tom Vasquez&nbsp;&nbsp;"&nbsp;&nbsp; 5560.23 "</tt><br>
<tt>&nbsp;&nbsp; " 2&nbsp;&nbsp;" Dick Mancini " 909225.24 "</tt><br>
<tt>&nbsp;&nbsp; " 3&nbsp;&nbsp;" Harry Wu&nbsp;&nbsp;&nbsp;&nbsp; "&nbsp;&nbsp;&nbsp;&nbsp;892.00 "</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; 3 rows in set (0.00 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; ROLLBACK; </tt><br>
<tt>&nbsp;&nbsp; Query OK, 0 rows affected (0.20 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; SELECT * FROM accounts;</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; " id " name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; " balance&nbsp;&nbsp; "</tt><br>
<tt>&nbsp;&nbsp; " 1&nbsp;&nbsp;" Tom Vasquez&nbsp;&nbsp;"&nbsp;&nbsp; </tt><tt>5460.23</tt><tt> "</tt><br>
<tt>&nbsp;&nbsp; " 2&nbsp;&nbsp;" Dick Mancini " </tt><tt>909325.24</tt><tt> "</tt><br>
<tt>&nbsp;&nbsp; " 3&nbsp;&nbsp;" Harry Wu&nbsp;&nbsp;&nbsp;&nbsp; "&nbsp;&nbsp;&nbsp;&nbsp;892.00 "</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; 3 rows in set (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; </tt>
</dpeccode><br>
<a name="phg018"></a>
<br><dpecjs><b>* Step 10</b>
<br>
To see what happens when the transaction is committed, the two <tt>UPDATE</tt> queries will be run again. Repeat Steps 4 through 6. 
Be certain to start the transaction first, though, or the queries will automatically take effect!
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; mysql&gt; START TRANSACTION</tt><br>
<tt>&nbsp;&nbsp; Query OK, 0 rows affected (0.00 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance-100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=2;</tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance+100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=1; </tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt><br>
<br>
</dpeccode><br>
<a name="phg019"></a>
<br><dpecjs><b>* Step 11</b>
<br>
Commit the transaction and confirm the results. Invoking the <tt>COMMIT</tt> command makes the transaction's effects permanent.
Once you enter <tt>COMMIT</tt>, the entire transaction is permanent, meaning that any changes are now in place. <tt>COMMIT</tt> also ends the transaction, returning MySQL to autocommit mode.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; mysql&gt; START TRANSACTION</tt><br>
<tt>&nbsp;&nbsp; Query OK, 0 rows affected (0.00 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance-100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=2;</tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; UPDATE accounts SET </tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; balance=(balance+100)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&gt; WHERE id=1; </tt><br>
<tt>&nbsp;&nbsp; Query OK, 1 row affected (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; Rows matched : 1&nbsp;&nbsp;Changed: 1&nbsp;&nbsp;Warnings: 0</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; COMMIT;</tt><br>
<tt>&nbsp;&nbsp; Query OK, 0 rows affected (0.07 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; SELECT * FROM accounts;</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; " id " name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; " balance&nbsp;&nbsp; "</tt><br>
<tt>&nbsp;&nbsp; " 1&nbsp;&nbsp;" Tom Vasquez&nbsp;&nbsp;"&nbsp;&nbsp; </tt><tt>5560.23</tt><tt> "</tt><br>
<tt>&nbsp;&nbsp; " 2&nbsp;&nbsp;" Dick Mancini " </tt><tt>909225.24</tt><tt> "</tt><br>
<tt>&nbsp;&nbsp; " 3&nbsp;&nbsp;" Harry Wu&nbsp;&nbsp;&nbsp;&nbsp; "&nbsp;&nbsp;&nbsp;&nbsp;892.00 "</tt><br>
<tt>&nbsp;&nbsp; +----+--------------+-----------+</tt><br>
<tt>&nbsp;&nbsp; 3 rows in set (0.01 sec)</tt><br>
<tt>&nbsp;&nbsp; mysql&gt; </tt>
</dpeccode><br>
<a name="phg020"></a>

<script language="JavaScript">insertAccQuestion('18','phg020.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phg021"></a>

<script language="JavaScript">insertAccQuestion('19','phg021.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phg022"></a>

<script language="JavaScript">insertAccQuestion('20','phg022.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phg023"></a>

<script language="JavaScript">insertAccQuestion('21','phg023.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phg024"></a>
<br><dpecw1>
	
In this lesson, you learned about one of the new features available in 
versions 4 and 4.1 of MySQL: database transactions. With transactions, 
you can set start and stop points and then enact or retract all of the 
queries as needed (for example, if one query failed, all of the queries 
can be undone).<br>
You also learned that you can either enter <tt>COMMIT</tt> to enact all of the queries or <tt>ROLLBACK</tt> to undo the effect of all of the queries.<br>
Finally, you learned about MySQL's autocommit mode, which means that any queries you execute take immediate effect.
	
</dpecw1><br>
<a name="phh001"></a><br><a name="topic13"></a><h2>Lesson 8. Using Prepared Statements</h2><dpecw1>

One of the new features added to the upgrades to versions 4 and 4.1 of 
MySQL are prepared statements. Prepared statements can be created out of
 certain types of queries in your PHP scripts to provide greater 
security and better performance.<br>
After completing this lesson, you should be able to:<br>
<ul>
	<li>
Define prepared statements
	</li>
	<li>
Bind<i> </i>PHP variables to a query's placeholders
	</li>
	<li>
Identify subqueries and their function in MySQL
	</li>
</ul>

</dpecw1><br>
<a name="phh002"></a>
<br><dpecw1>

<b>* Benefits of Prepared Statements</b><br>
Prepared statements were added to MySQL in version 4.1 and you can run 
prepared statements through PHP using the Improved MySQL Extension, 
added in PHP 5. The premise behind a prepared statement is that part of a
 query is essentially memorized by MySQL with specific elements being 
defined on the fly. The benefit of prepared statements are important: 
greater security and better performance. 

</dpecw1><br>
<a name="phh003"></a>
<br><dpecjs>Prepared statements can be created out of any <tt>INSERT</tt>, <tt>UPDATE</tt>, <tt>DELETE</tt>, or <tt>SELECT</tt>
 query. In order to use them with PHP, you must use PHP's Improved MySQL
 Extension, available as of PHP 5. Begin by defining your query, marking
 placeholders<i> </i>using question marks.
For this example, we'll populate the <tt>accounts</tt><i> </i>table. As you'll soon see, before the query is actually executed, the question marks will be assigned the appropriate values. 
<br>

<a name="phh004"></a>
<br><dpecjs>Next, prepare the statement in MySQL, assigning the results 
to a PHP variable. At this point, MySQL will parse the query, checking 
for valid syntax. The speed improvement with prepared statements stems 
from the fact that a query needs to be parsed only once, no matter how 
many times it is run (presumably with different values). For this 
reason, the speed benefit of using prepared statements applies only when
 the same query is being run multiple times with different values. 
<br>

<a name="phh005"></a>
<br><dpecjs>Next, you bind<i> </i>PHP variables to the query's 
placeholders. In other words, you state that one variable should be used
 for one question mark, another variable for the other question mark, 
and so on.
The <tt>sd</tt> part of the command indicates what kind of values should be expected. <ml_ins_href><ml_data_href> In this case, the query expects to receive one string (or generic type) and one decimal.
<br>

<br><a name="phh005a"></a>
<br><dpecw1>

<b>* Bound Value Types</b><br>
Use these characters to tell the <tt>mysql_stmt_bind_param()</tt> function what kinds of values to expect.<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Letter</b>

</th><th class="heading" scope="col">
<b>Represents</b>

	</th></tr>
	<tr valign="top">
<td>
<tt>d</tt>
</td>
<td>
decimal
</td>
	</tr>
	<tr valign="top">
<td>
<tt>i</tt>
</td>
<td>
integer
</td>
	</tr>
	<tr valign="top">
<td>
<tt>b</tt>
</td>
<td>
blob
</td>
	</tr>
	<tr valign="top">
<td>
<tt>s</tt>
</td>
<td>
all other types
</td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw1><br><br>
<a name="phh006"></a>
<br><dpecw1>
	
There are two kinds of prepared statements. Here we demonstrate <b>bound parameters</b>, where PHP variables are bound to a query. The other type is <b>bound results</b>, where the results of a query are bound to PHP variables.
	
</dpecw1><br>
<a name="phh007"></a>
<br><dpecw1>

At this point, you can assign values to the PHP variables and then execute the statement.<br>
<tt><tt>   </tt>$name = 'Hasumi Tanaka';<br>
&nbsp;  $balance = 45902.29; <br>
&nbsp;  mysqli_stmt_execute($stmt); </tt><br>
The values of <tt>$name</tt> and <tt>$balance</tt> will be used when the prepared statement is executed. <br>
To execute the statement again using different values, just repeat this last sequence.<br>
<tt><tt>   </tt>$name = 'Michelle Lambert';<br>
&nbsp;  $balance = 65487.88;<br>
&nbsp;  mysqli_stmt_execute($stmt); </tt>

</dpecw1><br>
<a name="phh008"></a>
<br><dpecjs><b>* Preparing Statements in a Script</b>
<br>
To see this process in action, let's write a script that quickly inserts several records into the <tt>accounts</tt><i> </i>table. We'll use the opportunity to demonstrate a couple of the other prepared statement-related functions.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Bind the variables.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>mysqli_stmt_bind_param($stmt, "sd", $name, $balance);</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; // Create an array of values to be inserted.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; $data = array(</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; array('Louise Calvin', 65465.99),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; array('Brad Jenson', 132.74),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; array('James Hurst', 432.74),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; array('William Fitzgerald', 841664.67),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; array('Scott Karlsson', 69.23),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; array('Nora Dunmire', 130654.44),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; array('Frank Marinelli', 87.63),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; array('Carlos Rubio', 9.98),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; array('Jane Anthony', 1324.02),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; array('George Wysocki', 49683.56)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; );</tt><br>
<br>
</dpeccode><br>
<a name="phh009"></a>
<br><dpecjs><b>* Step 1</b>
<br>
Create a new PHP script in your text editor or IDE.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;Prepared Statements&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # prepared.php</tt><br>
<br>
</dpeccode><br>
<a name="phh010"></a>
<br><dpecjs><b>* Step 2</b>
<br>
Connect to the <tt>test</tt><i> </i>database.
The <tt>test</tt> database, which contains the <tt>accounts</tt> table, will be used in this example.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;Prepared Statements&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # prepared.php</tt><br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('localhost','username', 'password', 'test') 
OR die ('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
<br>
<br>
</dpeccode><br>
<a name="phh011"></a>
<br><dpecjs><b>* Step 3</b>
<br>
Define and prepare the query.
The query is defined, using two placeholders for values to be assigned later. Then the <tt>mysqli_prepare()</tt> function sends this to MySQL, assigning the result to <tt>$stmt</tt>.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>// Make the query.</tt><br>
<tt>$query = "INSERT INTO accounts (name, balance) VALUES (?, ?)";</tt><br>
<br>
<tt>// Prepare the statement.</tt><br>
<tt>$stmt = mysqli_prepare($dbc, $query);</tt><br>
<br>
<tt>// Bind the variables.</tt><br>
<tt>mysqli_stmt_bind_param($stmt, "sd", $name, $balance);</tt><br>
<br>
<br>
</dpeccode><br>
<a name="phh012"></a>
<br><dpecjs><b>* Step 4</b>
<br>
Bind the appropriate variables and create a list of values to be 
inserted. The first line says that one string and one decimal value will
 be added to the prepared statement. The values will be found in the <tt>$name</tt> and <tt>$balance</tt> variables.
The <tt>$data</tt> array is a multidimensional list of all the values to
 be inserted. Using this structure, you can easily loop through each 
item and insert it into the database.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>// Bind the variables.</tt><br>
<tt>mysqli_stmt_bind_param($stmt, "sd", $name, $balance);</tt><br>
<br>
<tt>// Create an array of values to be inserted.</tt><br>
<tt>$data = array(</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;array('Louise Calvin', 65465.99),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;array('Brad Jenson', 132.74),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;array('James Hurst', 432.74),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;array('William Fitzgerald', 841664.67),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;array('Scott Karlsson', 69.23),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;array('Nora Dunmire', 130654.44),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;array('Frank Marinelli', 87.63),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;array('Carlos Rubio', 9.98),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;array('Jane Anthony', 1324.02),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;array('George Wysocki', 49683.56)</tt><br>
<tt>);</tt><br>
<br>
</dpeccode><br>
<a name="phh013"></a>
<br><dpecw1>

<b>* Step 5</b><br>
Print a caption and begin a <tt>foreach</tt> loop that executes the statements.<br>
The <tt>foreach</tt> loop will break each element of <tt>$data</tt> into its own array, called <tt>$record</tt>. Then the appropriate variables — <tt>$name</tt> and <tt>$balance</tt> — are given their values, based upon <tt>$record</tt>. Finally, the prepared statement is executed using these values.

</dpecw1><br><dpeccode>
<br>
<tt>// Print a caption.</tt><br>
<tt>echo "&lt;p&gt;The query being prepared is: $query&lt;/p&gt;\n";</tt><br>
<tt>// Loop through the array, inserting each record.</tt><br>
<tt>foreach ($data as $record) {</tt><br>
<tt>&nbsp;&nbsp; // Assign the variables.</tt><br>
<tt>&nbsp;&nbsp; $name = $record[0];</tt><br>
<tt>&nbsp;&nbsp; $balance = $record[1];</tt><br>
<tt>&nbsp;&nbsp; // Execute the query.</tt><br>
<tt>&nbsp;&nbsp; mysqli_stmt_execute($stmt);</tt><br>
<br>
</dpeccode><br>
<a name="phh014"></a>
<br><dpecw1>

<b>* Step 6</b><br>
Print the results of the execution and complete the loop.<br>
The <tt>echo</tt> statement just prints out what values are being inserted. The successful insertion of a record is indicated using the <tt>mysqli_stmt_affected_rows()</tt> function, which works as you expect it would (returning the number of affected rows). If a problem occurred, the <tt>mysqli_stmt_error()</tt> function returns the specific MySQL error message.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; // Print the results.</tt><br>
<tt>&nbsp;&nbsp; echo "&lt;p&gt;Name: $name&lt;br /&gt;Balance: $balance&lt;br /&gt;Result: ";</tt><br>
<tt>&nbsp;&nbsp; // Print a message based upon the result.</tt><br>
<tt>&nbsp;&nbsp; if (mysqli_stmt_affected_rows($stmt) == 1) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'OK';</tt><br>
<tt>&nbsp;&nbsp; } else {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'FAILED ' . mysqli_stmt_error($stmt);</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp; echo '&lt;/p&gt;';</tt><br>
<tt>} // End of foreach loop.</tt><br>
<br>
</dpeccode><br>
<a name="phh015"></a>
<br><dpecw1>

<b>* Step 7</b><br>
Close the statement and the database connection. <br>
The first function closes the prepared statement, freeing up the resources. At this point, <tt>$stmt</tt> no longer has a value. The second function closes the database connection.

</dpecw1><br><dpeccode>
<br>
<tt>// Close the statement.</tt><br>
<tt>mysqli_stmt_close($stmt);</tt><br>
<br>
<tt>// Close the connection.</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<br>
</dpeccode><br>
<a name="phh016"></a>
<br><dpecw1>

<b>* Step 8</b><br>
Complete the page.

</dpecw1><br><dpeccode>
<br>
<tt>// Close the statement.</tt><br>
<tt>mysqli_stmt_close($stmt);</tt><br>
<tt>// Close the connection.</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt><br>
<br>
</dpeccode><br>
<a name="phh017"></a>
<br><dpecw1>

<b>* Step 9</b><br>
Save the file as <tt>prepared.php</tt>, upload to your Web server, and test in your Web browser.

</dpecw1><br><dpeccode>
<br>
<tt>// Close the statement.</tt><br>
<tt>mysqli_stmt_close($stmt);</tt><br>
<tt>// Close the connection.</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt><br>
</dpeccode><br>
<a name="phh018"></a>
<br><dpecjs><b>* Full <tt></tt></b><tt>
<br>prepared.php</tt><b>*  Script</b>
In this script, prepared statements are executed using the Improved MySQL Extension functions.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;Prepared Statements&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # prepared.php</tt><br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('localhost','username', 'password', 'test') OR die</tt><tt> </tt><tt>('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
<tt>// Make the query.</tt><br>
<tt>$query = "INSERT INTO accounts (name, balance) VALUES (?, ?)";</tt><br>
<tt>// Prepare the statement.</tt><br>
<tt>$stmt = mysqli_prepare($dbc, $query);</tt><br>
<tt>// Bind the variables.</tt><br>
<tt>mysqli_stmt_bind_param($stmt, "sd", $name, $balance);</tt><br>
<tt>// Create an array of values to be inserted.</tt><br>
<tt>$data = array(</tt><br>
<tt>&nbsp;&nbsp; array('Louise Calvin', 65465.99),</tt><br>
<tt>&nbsp;&nbsp; array('Brad Jenson', 132.74),</tt><br>
<tt>&nbsp;&nbsp; array('James Hurst', 432.74),</tt><br>
<tt>&nbsp;&nbsp; array('William Fitzgerald', 841664.67),</tt><br>
<tt>&nbsp;&nbsp; array('Scott Karlsson', 69.23),</tt><br>
<tt>&nbsp;&nbsp; array('Nora Dunmire', 130654.44),</tt><br>
<tt>&nbsp;&nbsp; array('Frank Marinelli', 87.63),</tt><br>
<tt>&nbsp;&nbsp; array('Carlos Rubio', 9.98),</tt><br>
<tt>&nbsp;&nbsp; array('Jane Anthony', 1324.02),</tt><br>
<tt>&nbsp;&nbsp; array('George Wysocki', 49683.56)</tt><br>
<tt>);</tt><br>
<tt>// Print a caption.</tt><br>
<tt>echo "&lt;p&gt;The query being prepared is: $query&lt;/p&gt;\n";</tt><br>
<tt>// Loop through the array, inserting each record.</tt><br>
<tt>foreach ($data as $record) {</tt><br>
<tt>&nbsp;&nbsp; // Assign the variables.</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>$name = $record[0];</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>$balance = $record[1];</tt><br>
<tt>&nbsp;&nbsp; // Execute the query.</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>mysqli_stmt_execute($stmt);</tt><br>
<tt>&nbsp;&nbsp; // Print the results.</tt><br>
<tt>&nbsp;&nbsp; echo "&lt;p&gt;Name: $name&lt;br /&gt;Balance: $balance&lt;br /&gt;Result: ";</tt><br>
<tt>&nbsp;&nbsp; // Print a message based upon the result.</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>if (mysqli_stmt_affected_rows($stmt) == 1) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>echo 'OK';</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>} else {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>echo 'FAILED ' . mysqli_stmt_error($stmt);</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>}</tt><br>
<tt>&nbsp;&nbsp; echo '&lt;/p&gt;';</tt><br>
<tt> } // End of foreach loop.</tt><br>
<tt>// Close the statement.</tt><br>
<tt>mysqli_stmt_close($stmt);</tt><br>
<tt>// Close the connection.</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt><br>
</dpeccode><br>
<a name="phh019"></a>
<br><dpecw1>
	
Because of how MySQL deals with prepared statements, you don't actually need to sanctify your values using <tt>mysqli_real_escape_string()</tt> or similar functions. You should still perform basic validation in PHP, of course.
	
</dpecw1><br>
<a name="phh020"></a>
<br><dpecw1>

<b>* Introducing Subqueries</b><br>
Another new feature to MySQL is subqueries, which were added in version 4.1. Simply put, a subquery is a <tt>SELECT</tt> query within another query. The simplest subquery returns a single value, which can then be used in the main query.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp; SELECT * FROM </tt><i><tt>table1 </tt></i><tt>WHERE </tt><i><tt>columnX</tt></i><tt>=(SELECT MAX(</tt><i><tt>columnY</tt></i><tt>) FROM </tt><i><tt>table2</tt></i><tt>)</tt><br>
</dpeccode><br><dpecw2>

Here the subquery returns the highest value from <tt><i>columnY</i></tt> of <tt><i>table2</i></tt>. This value is then used to determine what data is selected from <tt><i>table1</i></tt>. 

</dpecw2><br>
<a name="phh021"></a>
<br><dpecw1>

More complicated subqueries can return a row or an entire table of data,
 which is then used by the main query. Subqueries also have their own 
operators: <tt>IN</tt>, <tt>ANY</tt>, <tt>ALL</tt>, <tt>EXISTS</tt>, and <tt>NOT EXISTS</tt>. <br>
While subqueries are a nice feature, the same result can often be achieved using a well-written join. 

</dpecw1><br>
<a name="phh024"></a>

<script language="JavaScript">insertAccQuestion('22','phh024.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phh025"></a>

<script language="JavaScript">insertAccQuestion('23','phh025.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phh026"></a>
<br><a name="topic14"></a><h2>Topic 8.1 Exercises</h2><br><b>* Exercise 1</b><dpecw1>

<br>
Try using prepared statements in a PHP script.

</dpecw1><br><dpecw2>

<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Step</b>

</th><th class="heading" scope="col">
<b>Action</b>

	</th></tr>
	<tr valign="top">
<td>
1
</td>
<td>
Create a new PHP script in your text editor or IDE.
</td>
	</tr>
	<tr valign="top">
<td>
2
</td>
<td>
Create the code that will connect to the <tt>test</tt> database.<br>
Assume that you are connecting to the <tt>test</tt> database in the <tt>accounts</tt> table.
</td>
	</tr>
	<tr valign="top">
<td>
3
</td>
<td>
Define and prepare the query that will insert the values of name (<tt><tt>$name</tt></tt>) and balance amount (<tt><tt>$balance</tt></tt>) into the <tt><tt>accounts</tt></tt> table.
</td>
	</tr>
	<tr valign="top">
<td>
4
</td>
<td>
Bind the appropriate variables and create a list of values to be inserted using the <tt><tt>$data</tt></tt>
 array. (Create about 8-10 values to insert.) When binding the 
variables, specify that one string and one decimal value will be added 
to the prepared statement.
</td>
	</tr>
	<tr valign="top">
<td>
5
</td>
<td>
Print the caption "The query being prepared is..." and begin a <tt><tt>foreach</tt></tt> loop that executes the statements.
</td>
	</tr>
	<tr valign="top">
<td>
6
</td>
<td>
Print the results of the execution in the following format: "Name: /Balance: /Result:"
</td>
	</tr>
	<tr valign="top">
<td>
7
</td>
<td>
Complete the <tt><tt>foreach</tt></tt> loop.
</td>
	</tr>
	<tr valign="top">
<td>
8
</td>
<td>
Close the statement and the database connection.
</td>
	</tr>
	<tr valign="top0">
<td>
9
</td>
<td>
Complete the page and save the file as <tt><tt>prepared.php</tt></tt>.
</td>
	</tr>
	<tr valign="top1">
<td>
10
</td>
<td>
<ml_ins_href><ml_data_href>php script.<br>
View your source code to see how it compares
</ml_data_href></ml_ins_href></td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw2><br>
<br><a name="phh026a"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;Prepared Statements&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # prepared.php</tt><br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('localhost','username', 'password', 'test') OR die</tt><tt> </tt><tt>('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
<tt>// Make the query.</tt><br>
<tt>$query = "INSERT INTO accounts (name, balance) VALUES (?, ?)";</tt><br>
<tt>// Prepare the statement.</tt><br>
<tt>$stmt = mysqli_prepare($dbc, $query);</tt><br>
<tt>// Bind the variables.</tt><br>
<tt>mysqli_stmt_bind_param($stmt, "sd", $name, $balance);</tt><br>
<tt>// Create an array of values to be inserted.</tt><br>
<tt>$data = array(</tt><br>
<tt>&nbsp;&nbsp; array('Louise Calvin', 65465.99),</tt><br>
<tt>&nbsp;&nbsp; array('Brad Jenson', 132.74),</tt><br>
<tt>&nbsp;&nbsp; array('James Hurst', 432.74),</tt><br>
<tt>&nbsp;&nbsp; array('William Fitzgerald', 841664.67),</tt><br>
<tt>&nbsp;&nbsp; array('Scott Karlsson', 69.23),</tt><br>
<tt>&nbsp;&nbsp; array('Nora Dunmire', 130654.44),</tt><br>
<tt>&nbsp;&nbsp; array('Frank Marinelli', 87.63),</tt><br>
<tt>&nbsp;&nbsp; array('Carlos Rubio', 9.98),</tt><br>
<tt>&nbsp;&nbsp; array('Jane Anthony', 1324.02),</tt><br>
<tt>&nbsp;&nbsp; array('George Wysocki', 49683.56)</tt><br>
<tt>);</tt><br>
<tt>// Print a caption.</tt><br>
<tt>echo "&lt;p&gt;The query being prepared is: $query&lt;/p&gt;\n";</tt><br>
<tt>// Loop through the array, inserting each record.</tt><br>
<tt>foreach ($data as $record) {</tt><br>
<tt>&nbsp;&nbsp; // Assign the variables.</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>$name = $record[0];</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>$balance = $record[1];</tt><br>
<tt>&nbsp;&nbsp; // Execute the query.</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>mysqli_stmt_execute($stmt);</tt><br>
<tt>&nbsp;&nbsp; // Print the results.</tt><br>
<tt>&nbsp;&nbsp; echo "&lt;p&gt;Name: $name&lt;br /&gt;Balance: $balance&lt;br /&gt;Result: ";</tt><br>
<tt>&nbsp;&nbsp; // Print a message based upon the result.</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>if (mysqli_stmt_affected_rows($stmt) == 1) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>echo 'OK';</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>} else {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>echo 'FAILED ' . mysqli_stmt_error($stmt);</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>}</tt><br>
<tt>&nbsp;&nbsp; echo '&lt;/p&gt;';</tt><br>
<tt> } // End of foreach loop.</tt><br>
<tt>// Close the statement.</tt><br>
<tt>mysqli_stmt_close($stmt);</tt><br>
<tt>// Close the connection.</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br><br>
<a name="phh027"></a>
<br><dpecw1>
	
In this lesson, you learned about the new prepared statements feature 
available in version 4.1 of MySQL. By writing a sample PHP script, you 
learned how to bind<i> </i>PHP variables to a query's placeholders, as well as specify bound value types. <br>
In addition, you learned the difference between the two types of prepared statements: bound parameters and bound results.<br>
You also learned about the subquery feature also introduced in version 4.1 of MySQL.
	
</dpecw1><br>
<a name="phi001"></a><br><a name="topic15"></a><h2>Lesson 9. Using PEAR</h2><dpecw1>

PEAR, the PHP Extension and Application Repository, is a collection of 
established code that programmers can incorporate into their own 
projects. This lesson discusses the advantages to using PEAR, as well as
 shows you how you can use this system in your own work.<br>
After completing this lesson, you should be able to:<br>
<ul>
	<li>
Identify the advantages of using PEAR in your projects
	</li>
	<li>
Utilize PEAR to add benchmarking to a PHP script
	</li>
	<li>
Define objects and classes used in object-oriented programming
	</li>
</ul>

</dpecw1><br>
<a name="phi002"></a>
<br><dpecjs><b>* PHP Extension and Application Repository</b>
<br>
PEAR, the PHP Extension and Application Repository, is a structured 
library and system for reusable PHP components. PEAR provides PHP 
components in the form of packages. The official Web site for PEAR is <script>writeLinkText("http://pear.php.net");</script><a href="javascript:floatWin('http://pear.php.net','internet_win','resizable=yes,width=640,height=480,scrollbars=yes,menubar=yes')" title="Open http://pear.php.netin a new window">http://pear.php.net</a>.
Note: All Web sites are current at the time of writing but are subject to change.
<br>

<a name="phi003"></a>
<br><dpecw1>

Many things could be done using PEAR, including:<br>
<ul>
	<li>
Interacting with MySQL
	</li>
	<li>
Controlling page caching
	</li>
	<li>
Sending plain or HTML email
	</li>
	<li>
Performing HTTP authentication
	</li>
	<li>
Creating and validating HTML forms 
	</li>
</ul>

</dpecw1><br>
<a name="phi004"></a>
<br><dpecw1>

There are many advantages to using PEAR. First of all, you can more 
quickly develop applications. Second, your Web sites will then be 
relying upon tested, established code instead of your own (potentially 
buggy) work. <br>
An important aspect of PEAR is the set of standards under which all PHP 
modules must be written (in terms of variable names, document structure,
 and so forth). Even if you never attempt to add to the PEAR library, 
following these standards as a PHP programmer is well worth considering

</dpecw1><br>
<a name="phi005"></a>
<br><dpecw1>

There are some downsides to PEAR. For one, PEAR and the modules you'll 
want to use must be installed on a server (and the installation process 
is not as foolproof as it could be). Second, not every PEAR module is as
 well documented or as smooth-running as it could be. <br>
Some PEAR packages will not work on the Windows operating system because
 they involve Unix-specific functions. To see the currently available 
list of packages, type <tt>pear list-remote-packages</tt> in a command prompt, assuming the PEAR package manager has been installed.

</dpecw1><br>
<a name="phi006"></a>
<br><dpecw1>
	
There is a subset of PEAR called PECL ("pickle," the PHP Extension Code 
Library) that consists of standard PEAR modules written directly in C 
and C++, rather than PHP, resulting in better performance.
	
</dpecw1><br>
<a name="phi007"></a>
<br><dpecjs>Still, it's not difficult for the intermediate PHP 
programmer to use PEAR's classes, even without any formal training in 
object-oriented programming. 
As just one example of what you can do with PEAR, we'll add benchmarking
 to an existing script to see how long various aspects of the script 
take to execute. In order to follow this example, you'll need to make 
sure that PEAR is installed, as well as the <tt>Benchmark</tt><i> </i>class.
<br>

<a name="phi008"></a>
<br><dpecw1>

<b>* Step 1</b><br>
We'll add benchmarking to the already created <tt>mysqli.php</tt> script. <ml_ins_href><ml_data_href>php form code.<br>
If you have not yet created this script, you can apply the concept demonstrated here to any other file. Open <tt>mysqli.php</tt> in your text editor or IDE.

</ml_data_href></ml_ins_href></dpecw1><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;View Submitted Comments&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # mysqli.php</tt><br>
</dpeccode><br>
<br><a name="phi008a"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;View Submitted Comments&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # mysqli.php</tt><br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('localhost','username', 'password', 'test') OR die</tt><tt> </tt><tt>('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
<tt>// Make the query.</tt><br>
<tt>$query = "SELECT name, comment, DATE_FORMAT(date_entered, '%M %D, %Y') FROM comments ORDER BY date_entered DESC";</tt><br>
<tt>// Run the query and handle the results.</tt><br>
<tt>if ($result = @mysqli_query($dbc, </tt><tt>$query)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (mysqli_num_rows($result) &gt; 0) { // Some records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print each record in a loop.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>while ($row = mysqli_fetch_array($result, MYSQLI_NUM)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "&lt;h3&gt;$row[0] ($row[2])&lt;/h3&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;$row[1]&lt;/p&gt;&lt;br /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp; } else { // No records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;There are currently no comments in the database.&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>} else { // Query didn't run properly.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>echo '&lt;p&gt;&lt;font color="red"&gt;MySQL Error: ' . mysqli_error($dbc) .</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>'&lt;br /&gt;&lt;br /&gt;Query: ' . $query .</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>'&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt>}</tt><br>
<tt>// Free the result and close the connection.</tt><br>
<tt>mysqli_free_result($result);</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br><br>
<a name="phi009"></a>
<br><dpecw1>

<b>* Step 2</b><br>
At the beginning of the script, create a new timer <br>
To use any PEAR class, you must first require the appropriate script. Then, following the example shown in the <tt>Timer.php</tt> script (which is part of the <tt>Benchmark</tt> package), create a new timer object, called <tt>$t</tt>, and start the timer.

</dpecw1><br><dpeccode>
<br>
<tt>&lt;?php # benchmark.php</tt><br>
<tt>// Require the file and begin the process.</tt><br>
<tt>require_once('Benchmark/Timer.php');</tt><br>
<tt>$t = new Benchmark_Timer;</tt><br>
<tt>$t-&gt;start();</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
</dpeccode><br>
<a name="phi010"></a>
<br><dpecw1>

<b>* Step 3</b><br>
After the initial HTML code, set a marker.<br>
First, time how long it takes to print the header HTML. To do so, I set a
 marker using an appropriate marker name or caption with the <tt>setMarker()</tt> function (or method).

</dpecw1><br><dpeccode>
<br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;View Submitted Comments&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php</tt><br>
<tt>// Set a marker.</tt><br>
<tt>$t-&gt;setMarker ('Header printed');</tt><br>
<br>
</dpeccode><br>
<a name="phi011"></a>
<br><dpecw1>

<b>* Step 4</b><br>
After connecting to the database, set another marker.<br>
Database connections are normally big resource hogs. To time how long this takes, create another marker.

</dpecw1><br><dpeccode>
<br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php</tt><br>
<tt>// Set a marker.</tt><br>
<tt>$t-&gt;setMarker ('Header printed');</tt><br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('localhost', 'username', 'password', 'test')
 OR die ('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
<tt>$t-&gt;setMarker ('Connected to MySQL');</tt><br>
<br>
</dpeccode><br>
<a name="phi012"></a>
<br><dpecw1>

<b>* Step 5</b><br>
After querying the database, make another marker.<br>
This third marker will be used to determine how long it took to define and run a query.

</dpecw1><br><dpeccode>
<tt>// Make the query.</tt><br>
<tt>$query = "SELECT name, comment, DATE_FORMAT(date_entered, '%M %D, %Y') FROM comments ORDER BY date_entered DESC";</tt><br>
<tt>// Run the query and handle the results.</tt><br>
<tt>if ($result = @mysqli_query($dbc, $query)) {</tt><br>
<tt>&nbsp;&nbsp; $t-&gt;setMarker ('Query has been run');</tt><br>
<br>
</dpeccode><br>
<a name="phi013"></a>
<br><dpecw1>

<b>* Step 6</b><br>
After printing all of the query results, set another marker.

</dpecw1><br><dpeccode>
<br>
<tt>// Run the query and handle the results.</tt><br>
<tt>if ($result = @mysqli_query($dbc, $query)) {</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>$t-&gt;setMarker ('Query has been run');</tt><br>
<tt>&nbsp;&nbsp; if (mysqli_num_rows($result) &gt; 0) { // Some records returned.</tt><br>
<tt>&nbsp;&nbsp; // Print each record in a loop.</tt><br>
<tt>&nbsp;&nbsp; while ($row = mysqli_fetch_array($result, MYSQLI_NUM)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "&lt;h3&gt;$row[0] ($row[2])&lt;/h3&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;$row[1]&lt;/p&gt;&lt;br /&gt;";</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp; $t-&gt;setMarker ('Finished printing the results');</tt><br>
<br>
</dpeccode><br>
<a name="phi014"></a>
<br><dpecw1>

<b>* Step 7</b><br>
After closing the database connection, establish the final marker.

</dpecw1><br><dpeccode>
<br>
<tt>&nbsp;&nbsp;} else { // No records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;There are currently no comments in the database.&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;}</tt><br>
<tt>} else { // Query didn't run properly.</tt><br>
<tt>&nbsp;&nbsp; echo '&lt;p&gt;&lt;font color="red"&gt;MySQL Error:' . 
mysqli_error($dbc) . '&lt;br /&gt;&lt;br /&gt;Query: ' . $query . 
'&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt>}</tt><br>
<tt>// Free the result and close the connection.</tt><br>
<tt>mysqli_free_result($result);</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>$t-&gt;setMarker ('Free and Close');</tt><br>
</dpeccode><br>
<a name="phi015"></a>
<br><dpecw1>

<b>* Step 8</b><br>
Finally, stop the timer.<br>
The <tt>stop()</tt> method of the timer will end the benchmarking process.

</dpecw1><br><dpeccode>
<br>
<tt>// Free the result and close the connection.</tt><br>
<tt>mysqli_free_result($result);</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>$t-&gt;setMarker ('Free and Close');</tt><br>
<tt>// Stop the timer and print the results.</tt><br>
<tt>$t-&gt;stop();</tt><br>
</dpeccode><br>
<a name="phi016"></a>
<br><dpecw1>

<b>* Step 9</b><br>
Print out the benchmark results.<br>
Once you've stopped the timer, a call to the <tt>getProfiling()</tt> function will return a multidimensional array with the timing results. 

</dpecw1><br><dpeccode>
<br>
<tt>// Stop the timer and print the results.</tt><br>
<tt>$t-&gt;stop();</tt><br>
<tt>$result = $t-&gt;getProfiling();</tt><br>
<tt>foreach ($result as $element) {</tt><br>
<tt>&nbsp;&nbsp; echo "&lt;p&gt;{$element['name']}: {$element['diff']}&lt;/p&gt;";</tt><br>
<tt>}</tt><br>
<br>
</dpeccode><br>
<a name="phi017"></a>
<br><dpecw1>

<tt>foreach</tt><b>*  Loop</b><br>
The easiest way to print out <tt>$result</tt> is to use a <tt>foreach</tt> loop. Within the loop, each element of the <tt>$result</tt> array is itself an array of four elements: <i><tt>name</tt> </i>(the marker name), <tt><i><tt>time</tt></i></tt><i> </i>(the time the marker was set), <tt><i><tt>diff</tt></i></tt><i> </i>(the difference between this marker and the previous marker or start), and <tt><i><tt>total</tt></i></tt><i> </i>(the
 total time elapsed since the timer was started). Using this 
information, print out the name of each marker and the amount of time 
each marker took.

</dpecw1><br><dpeccode>
<br>
<tt>// Stop the timer and print the results.</tt><br>
<tt>$t-&gt;stop();</tt><br>
<tt>$result = $t-&gt;getProfiling();</tt><br>
<tt>foreach ($result as $element) {</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>echo "&lt;p&gt;{$element</tt><tt>['name']}: {$element['diff']}&lt;/p&gt;";</tt><br>
<tt>}</tt><br>
</dpeccode><br>
<a name="phi018"></a>
<br><dpecjs><b>* Step 10</b>
<br>
Save the file as <tt>benchmark.php</tt>, upload to your Web server, and test in your Web browser. At the bottom of the page, the result of using the <tt>Benchmark</tt>
 class helps reveal how long different steps of the script took to 
execute.
Judging by the resulting numbers, connecting to MySQL and executing the 
query are the most involving steps, taking ten times as long as any 
other step.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>// Stop the timer and print the results.</tt><br>
<tt>$t-&gt;stop();</tt><br>
<tt>$result = $t-&gt;getProfiling();</tt><br>
<tt>foreach ($result as $element) {</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>echo "&lt;p&gt;{$element</tt><tt>['name']}: {$element['diff']}&lt;/p&gt;";</tt><br>
<tt>}</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt><br>
<br>
<br>
</dpeccode><br>
<a name="phi019"></a>
<br><dpecjs><b>* Benchmark Timer Script</b>
<br>
Using PEAR's <tt>Benchmark</tt> class, we time how long various aspects of this script take.
<br>
</dpecjs><br><dpeccode>
<br>
<tt>&lt;?php # benchmark.php</tt><br>
<tt>// Require the file and begin the process.</tt><br>
<tt>require_once('Benchmark/Timer.php');</tt><br>
<tt>$t = new Benchmark_Timer;</tt><br>
<tt>$t-&gt;start();</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;View Submitted Comments&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php</tt><br>
<tt>// Set a marker.</tt><br>
<tt>$t-&gt;setMarker ('Header printed');</tt><br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('</tt><i><tt>localhost</tt></i><tt>', '</tt><i><tt>username</tt></i><tt>', '</tt><i><tt>password</tt></i><tt>', '</tt><i><tt>test</tt></i><tt>') OR die ('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
<tt>$t-&gt;setMarker ('Connected to MySQL');</tt><br>
<tt>// Make the query.</tt><br>
<tt>$query = "SELECT name, comment, DATE_FORMAT(date_entered, '%M %D, %Y') FROM comments ORDER BY date_entered DESC";</tt><br>
<tt>// Run the query and handle the results.</tt><br>
<tt>if ($result = @mysqli_query($dbc, $query)) {</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>$t-&gt;setMarker ('Query has been run');</tt><br>
<tt>&nbsp;&nbsp; if (mysqli_num_rows($result) &gt; 0) { // Some records returned.</tt><br>
<tt>&nbsp;&nbsp; // Print each record in a loop.</tt><br>
<tt>&nbsp;&nbsp; while ($row = mysqli_fetch_array($result, MYSQLI_NUM)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;h3&gt;$row[0] ($row[2])&lt;/h3&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;$row[1]&lt;/p&gt;&lt;br /&gt;";</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>$t-&gt;setMarker ('Finished printing the results');</tt><br>
<tt>&nbsp;&nbsp;} else { // No records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;There are currently no comments in the database.&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;}</tt><br>
<tt>} else { // Query didn't run properly.</tt><br>
<tt>&nbsp;&nbsp; echo '&lt;p&gt;&lt;font color="red"&gt;MySQL Error: ' .
 mysqli_error($dbc) . '&lt;br/&gt;&lt;br /&gt;Query: ' . $query . 
'&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt>}</tt><br>
<tt>// Free the result and close the connection.</tt><br>
<tt>mysqli_free_result($result);</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>$t-&gt;setMarker ('Free and Close');</tt><br>
<tt>// Stop the timer and print the results.</tt><br>
<tt>$t-&gt;stop();</tt><br>
<tt>$result = $t-&gt;getProfiling();</tt><br>
<tt>foreach ($result as $element) {</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>echo "&lt;p&gt;{$element['</tt><i><tt>name</tt></i><tt>']}: {$element['</tt><i><tt>diff</tt></i><tt>']}&lt;/p&gt;";</tt><br>
<tt>}</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt><br>
</dpeccode><br>
<a name="phi020"></a>
<br><dpecw1>
	
If you are really interested in fine-tuning the performance of your Web applications, use the <tt>Benchmark</tt><i> </i>class
 to time your scripts, and then focus on those parts that take the 
longest to execute (for example, the database query in this script). You
 can also use this class to see the speed difference between, say, using
 <tt>mysql_*</tt> versus <tt>mysqli_*</tt> functions, or to see the benefit of prepared statements.
	
</dpecw1><br>
<a name="phi021"></a>
<br><dpecw1>

<b>* Object-Oriented Programming</b><br>
There is one last variable type that has not yet been discussed: 
objects. Object-oriented programming (OOP) is a subject so complex that 
entire books are dedicated to the subject. PHP has supported objects for
 some time now, and version 5 of the language has taken that support to 
new heights. You can go your entire PHP programming life without ever 
using objects.

</dpecw1><br>
<a name="phi022"></a>
<br><dpecw1>

So that the subject isn't entirely foreign to you, here's a three-second introduction: you use <b>objects</b> to encapsulate related blocks of code into one easy-to-use, easy-to-maintain entity. <br>
You start by creating a class. A <b>class</b> is a definition of a 
thing, or its structure and behavior, normally containing both functions
 (called methods) and variables (called properties). <br>

</dpecw1><br>
<a name="phi023"></a>
<br><dpecw1>

<b>* Creating an Instance of the Class</b><br>
Once you've defined a class, you can create an instance of that class, which is a variable of an object type.<br>
<tt>$var = new <i>ObjectName</i>;</tt><br>
To then call an object's method (a function), the syntax is<br>
<tt>$var-&gt;<i>functionName</i>();</tt><br>
If you ever encounter this syntax, as with the PEAR example in this lesson, you'll now understand its meaning.

</dpecw1><br>
<a name="phi024"></a>
<br><dpecw1>

More advanced objects involve special functions — called <b>constructors</b> — that are called when a new instance is created and those that are invoked when an instance is deleted — called <b>destructors</b>. There is also <b>inheritance</b>, where you create a new class by expanding upon an existing class definition. 

</dpecw1><br>
<a name="phi025"></a>
<br><dpecw1>

While OOP is quite powerful, it's not for the faint of heart, nor should
 you start trying to write your own objects without a thorough 
understanding of the concept. You can continue to program in PHP without
 ever using objects, without limiting your potential at all. Also, even 
the relatively novice programmer can use existing objects — like the 
PEAR body of code — by merely following the example syntax.

</dpecw1><br>
<a name="phi026"></a>

<script language="JavaScript">insertAccQuestion('24','phi026.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phi029"></a>

<script language="JavaScript">insertAccQuestion('25','phi029.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phi030"></a>
<br><a name="topic16"></a><h2>Topic 9.1 Exercises</h2><br><b>* Exercise 1</b><dpecw1>

<br>
Try adding PEAR's <tt>Benchmark</tt> class to an existing PHP script.

</dpecw1><br><dpecw2>

<br>
<ml_ins_table>
<table summary="Take these steps in the order indicated" width="92%" border="1" cellpadding="4" cellspacing="0">
	<tbody><tr valign="top">
<th class="heading" scope="col">
<b>Step</b>

</th><th class="heading" scope="col">
<b>Action</b>

	</th></tr>
	<tr valign="top">
<td>
1
</td>
<td>
Open <tt><tt>mysql.php</tt></tt> in your text editor. <ml_ins_href><ml_data_href>php form code.<br>
If you have not created this script, you can add the <tt><tt>Benchmark</tt></tt> class to any other file.
</ml_data_href></ml_ins_href></td>
	</tr>
	<tr valign="top">
<td>
2
</td>
<td>
At the beginning of the script, create a new timer object (<tt><tt>$t</tt></tt>) and start the timer.
</td>
	</tr>
	<tr valign="top">
<td>
3
</td>
<td>
Set a marker to time how long it takes to print the header HTML.
</td>
	</tr>
	<tr valign="top">
<td>
4
</td>
<td>
Set a marker to time how long it takes to connect to the database.
</td>
	</tr>
	<tr valign="top">
<td>
5
</td>
<td>
Set a marker to time how long it takes to define and run a query.
</td>
	</tr>
	<tr valign="top">
<td>
6
</td>
<td>
Set a marker to time how long it takes to print the query.
</td>
	</tr>
	<tr valign="top">
<td>
7
</td>
<td>
Set a marker to time how long it takes to close the database connection.
</td>
	</tr>
	<tr valign="top">
<td>
8
</td>
<td>
Use the <tt><tt>stop()</tt></tt> method to stop the timer. Then print the benchmark results using a <tt><tt>foreach</tt></tt> loop.
</td>
	</tr>
	<tr valign="top0">
<td>
9
</td>
<td>
Complete the page and save the file as <tt><tt>benchmark.php</tt></tt>.
</td>
	</tr>
	<tr valign="top1">
<td>
10
</td>
<td>
<ml_ins_href><ml_data_href>php script.<br>
View your source code to see how it compares
</ml_data_href></ml_ins_href></td>
	</tr>
</tbody></table>
</ml_ins_table>

</dpecw2><br>
<br><a name="phi030a"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&lt;?php # benchmark.php</tt><br>
<tt>// Require the file and begin the process.</tt><br>
<tt>require_once('Benchmark/Timer.php');</tt><br>
<tt>$t = new Benchmark_Timer;</tt><br>
<tt>$t-&gt;start();</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;View Submitted Comments&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php</tt><br>
<tt>// Set a marker.</tt><br>
<tt>$t-&gt;setMarker ('Header printed');</tt><br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('</tt><i><tt>localhost</tt></i><tt>', '</tt><i><tt>username</tt></i><tt>', '</tt><i><tt>password</tt></i><tt>', '</tt><i><tt>test</tt></i><tt>') OR die ('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
<tt>$t-&gt;setMarker ('Connected to MySQL');</tt><br>
<tt>// Make the query.</tt><br>
<tt>$query = "SELECT name, comment, DATE_FORMAT(date_entered, '%M %D, %Y') FROM comments ORDER BY date_entered DESC";</tt><br>
<tt>// Run the query and handle the results.</tt><br>
<tt>if ($result = @mysqli_query($dbc, $query)) {</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>$t-&gt;setMarker ('Query has been run');</tt><br>
<tt>&nbsp;&nbsp; if (mysqli_num_rows($result) &gt; 0) { // Some records returned.</tt><br>
<tt>&nbsp;&nbsp; // Print each record in a loop.</tt><br>
<tt>&nbsp;&nbsp; while ($row = mysqli_fetch_array($result, MYSQLI_NUM)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo "&lt;h3&gt;$row[0] ($row[2])&lt;/h3&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;$row[1]&lt;/p&gt;&lt;br /&gt;";</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>$t-&gt;setMarker ('Finished printing the results');</tt><br>
<tt>&nbsp;&nbsp;} else { // No records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; echo '&lt;p&gt;There are currently no comments in the database.&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp;}</tt><br>
<tt>} else { // Query didn't run properly.</tt><br>
<tt>&nbsp;&nbsp; echo '&lt;p&gt;&lt;font color="red"&gt;MySQL Error: ' .
 mysqli_error($dbc) . '&lt;br/&gt;&lt;br /&gt;Query: ' . $query . 
'&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt>}</tt><br>
<tt>// Free the result and close the connection.</tt><br>
<tt>mysqli_free_result($result);</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>$t-&gt;setMarker ('Free and Close');</tt><br>
<tt>// Stop the timer and print the results.</tt><br>
<tt>$t-&gt;stop();</tt><br>
<tt>$result = $t-&gt;getProfiling();</tt><br>
<tt>foreach ($result as $element) {</tt><br>
<tt>&nbsp;&nbsp; </tt><tt>echo "&lt;p&gt;{$element['</tt><i><tt>name</tt></i><tt>']}: {$element['</tt><i><tt>diff</tt></i><tt>']}&lt;/p&gt;";</tt><br>
<tt>}</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br><br>
<br><a name="phi030b"></a>
<br><dpecjs></dpecjs><br><dpeccode>
<br>
<tt>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</tt><br>
<tt>&lt;html xmlns="http://www.w3.org/1999/xhtml"xml:lang="en" lang="en"&gt;</tt><br>
<tt>&lt;head&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;meta http-equiv="content-type" content="text/html; charset=iso-8859-1" /&gt;</tt><br>
<tt>&nbsp;&nbsp; &lt;title&gt;View Submitted Comments&lt;/title&gt;</tt><br>
<tt>&lt;/head&gt;</tt><br>
<tt>&lt;body&gt;</tt><br>
<tt>&lt;?php # mysqli.php</tt><br>
<tt>// Make the connection.</tt><br>
<tt>$dbc = @mysqli_connect ('localhost','username', 'password', 'test') OR die</tt><tt> </tt><tt>('Could not connect to MySQL: ' . mysqli_connect_error() );</tt><br>
<tt>// Make the query.</tt><br>
<tt>$query = "SELECT name, comment, DATE_FORMAT(date_entered, '%M %D, %Y') FROM comments ORDER BY date_entered DESC";</tt><br>
<tt>// Run the query and handle the results.</tt><br>
<tt>if ($result = @mysqli_query($dbc, </tt><tt>$query)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>if (mysqli_num_rows($result) &gt; 0) { // Some records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Print each record in a loop.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><tt>while ($row = mysqli_fetch_array($result, MYSQLI_NUM)) {</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo "&lt;h3&gt;$row[0] ($row[2])&lt;/h3&gt;</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;$row[1]&lt;/p&gt;&lt;br /&gt;";</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</tt><br>
<tt>&nbsp;&nbsp; } else { // No records returned.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo '&lt;p&gt;There are currently no comments in the database.&lt;/p&gt;';</tt><br>
<tt>&nbsp;&nbsp; }</tt><br>
<tt>} else { // Query didn't run properly.</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>echo '&lt;p&gt;&lt;font color="red"&gt;MySQL Error: ' . mysqli_error($dbc) .</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>'&lt;br /&gt;&lt;br /&gt;Query: ' . $query .</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt>'&lt;/font&gt;&lt;/p&gt;';// Debugging message.</tt><br>
<tt>}</tt><br>
<tt>// Free the result and close the connection.</tt><br>
<tt>mysqli_free_result($result);</tt><br>
<tt>mysqli_close($dbc);</tt><br>
<tt>?&gt;</tt><br>
<tt>&lt;/body&gt;</tt><br>
<tt>&lt;/html&gt;</tt>
</dpeccode><br><br>
<a name="phi031"></a>
<br><dpecw1>
	
In this lesson, you learned how to use the PEAR system in your own work.
 You learned the advantages to using PEAR in existing PHP scripts, and 
as an example, added the PEAR <tt>Benchmark</tt> class to an existing script.<br>
In addition, you were introduced to objects in classes used in 
object-oriented programming. Working with OOP requires a thorough 
knowledge of the subject, but this introduction can help you identify 
existing objects.
	
</dpecw1><br>
<a name="phj001"></a>
<br><a name="topic17"></a><h2>Lesson 10. Course in Review</h2><dpecw1>

This lesson allows you an opportunity to review the principles and practices you have learned in this course.<br>
It reviews the material presented in this course through questions and activities.

</dpecw1><br>
<a name="phj003"></a>

<script language="JavaScript">insertAccQuestion('26','phj003.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phj005"></a>

<script language="JavaScript">insertAccQuestion('27','phj005.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phj006"></a>

<script language="JavaScript">insertAccQuestion('28','phj006.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phj007"></a>

<script language="JavaScript">insertAccQuestion('29','phj007.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<a name="phj008"></a>

<script language="JavaScript">insertAccQuestion('30','phj008.htm',true)</script>
<noscript>Please download a browser that supports JavaScript.<BR></noscript>
<script language="JavaScript">
<!--
writeCopyrightInfo();
var totalTopics =17;
//-->
</script><br><br><center>© 2006 MindLeaders, Inc. All Rights Reserved.
<noscript><P>Your browser does not support script tags. Please update your system with a browser that supports them.</P></noscript>

</center></dpecjs></dpecjs></ml_data_href></ml_ins_href></dpecjs></dpecjs></dpecjs></dpecjs></dpecjs></dpecjs></dpecjs></dpecjs></dpecjs></dpecjs></dpecjs></dpecjs></body></html>